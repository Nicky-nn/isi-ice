import{r as p,j as e}from"./react-C-yax-zd.js";import{o as Ne}from"./@hookform-CI7dTiWF.js";import{C as W,b as Ue,u as We}from"./react-hook-form-Cc6cmx_T.js";import{A as ne}from"./AlertLoading-CGYU8vZk.js";import{S as Ke}from"./SimpleContainer-tFVAehGQ.js";import{B as _e}from"./Breadcrumb-BAVYU1BR.js";import{S as se}from"./SimpleCard-Cf1MrNuW.js";import{A as V,M as ce,u as _,i as H,b as De,g as Z,a as Ce,c as ve,h as Ge,d as je,s as He,o as Qe}from"./index-eXxrUaeE.js";import{e as ee}from"./@tanstack-CH50zjZF.js";import{g as N,G as U}from"./graphql-request-rGYrdPjm.js";import{c as Q,a as B,d as G,e as Xe}from"./yup-DbVgGITq.js";import{S as J,A as we}from"./react-select-u2NJ9wTD.js";import{A as Te}from"./AlertError-Drenn0X8.js";import{M as L}from"./MyInputLabel-BamhhSIO.js";import{r as K}from"./ReactSelect-CWkwVJtW.js";import{u as Ze}from"./useQueryActividadesPorDocumentoSector-CljpSRED.js";import{aK as R,az as Y,g as F,b1 as Je,aG as Ye,b2 as eo,a5 as le,a6 as de,a7 as ue,a8 as me,aJ as C,b3 as oo,h as ae,f as fe,b4 as Ee,aO as ye,b5 as $,aQ as z,ao as to,ak as ao,ah as io,aa as Fe,k as Me,b6 as ro,b7 as no,e as q,aZ as ie,ae as Ae,b8 as so,b9 as co,ba as lo,bb as uo,bc as mo,bd as go,B as po,be as ho,an as re,bf as xo,bg as jo,aN as fo}from"./@mui-Cg5JgIJd.js";import{M as Be}from"./material-react-table-B3_JpHKP.js";import{P as X}from"./index-CmjSjgDW.js";import{f as Co,C as yo,a as bo}from"./ClienteRegistroDialog-D7IqBZrH.js";import{M as ke}from"./muiTableAdvancedOptionsProps-8HbDsjdr.js";import{B as Ie}from"./react-toastify-Bq65RiZx.js";import{S as qe}from"./sweetalert2-CxYvYGPM.js";import{n as M}from"./NumberInput-ChEcYOmf.js";import{I as be}from"./rc-input-number-DHeBSjOn.js";import{a as Oe}from"./notification-CZdNX9HX.js";import{N as pe}from"./NumeroMask-BhIfq4lN.js";import{E as Po}from"./@tinymce-M7_O7Lh-.js";import{y as So}from"./lodash-Dwhj6_6J.js";import"./imask-JlAOpWDu.js";import{I as vo}from"./react-imask-BXhbtwMr.js";import{w as Eo}from"./sweetalert2-react-content-BL0HHBIv.js";import{R as Ao}from"./RepresentacionGraficaUrls-DrGrKeqi.js";import"./@babel-BWOPM2cf.js";import"./Typography-SNySdv6H.js";import"./clsx-B-dksMZM.js";import"./react-router-dom-BXf9Krd-.js";import"./react-dom-BMaWjgIA.js";import"./scheduler-CzFDRTuY.js";import"./react-router-m6rhPc7O.js";import"./@remix-run-DEp2-txB.js";import"./react-datepicker-D7PCQ8zk.js";import"./date-fns-9p2ure4y.js";import"./react-onclickoutside-vgQ6ifgl.js";import"./@floating-ui-BqRERJ-b.js";import"./perfect-scrollbar-BfaLzep3.js";import"./jwt-decode-VWaDGczM.js";import"./nanoid-CeQjyfxW.js";import"./@rc-component-BLzWySNC.js";import"./classnames-F3cnkUDL.js";import"./rc-input-CDxr26_S.js";import"./rc-util-RNQGGLoE.js";import"./react-is-DcfIKM1A.js";import"./@emotion-D9k8Qpvi.js";import"./hoist-non-react-statics-DQogQWOa.js";import"./stylis-NkKAe6Bn.js";import"./react-transition-group-C1IEqfrK.js";import"./dom-helpers-D0mFdbeO.js";import"./prop-types-tGFuYKac.js";import"./@popperjs-BQBsAJpH.js";import"./graphql-BS3ZITc9.js";import"./cross-fetch-Ml2K_YIJ.js";import"./property-expr-DEi1ZLzV.js";import"./tiny-case-BJ7jYKNY.js";import"./toposort-CW3e93qZ.js";import"./use-isomorphic-layout-effect-CqeZr6kb.js";import"./memoize-one-BdPwpGay.js";import"./highlight-words-DHKmS53s.js";import"./FormTextField-DeIeSGMe.js";import"./yup-locales-C3yB5wWh.js";import"./materialReactTableUtils-RKRDldrD.js";const Io=N`
  query PLANTILLA_DETALLE_EXTRA {
    plantillasDetalleExtra {
      title
      description
      content
    }
  }
`,Do=async()=>{try{const o=new U("https://sandbox.isipass.net/api"),t=localStorage.getItem(V);return o.setHeader("authorization",`Bearer ${t}`),(await o.request(Io)).plantillasDetalleExtra}catch(o){throw new ce(o)}},wo=(o=[])=>{const{data:t,isLoading:i,isError:r,error:m}=ee({queryKey:["plantillaDetalleExtra",...o],queryFn:async()=>{const l=await Do();return l.length>0?l:[]}});return{plantillaDetalleExtra:t,pdeLoading:i,pdeIsError:r,pdeError:m}},$e={notificacion:!1,tipoCambio:1,actividadEconomica:null,tipoCliente:"N",cliente:null,codigoCliente:"",codigoExcepcion:1,codigoMetodoPago:{codigoClasificador:1,descripcion:"EFECTIVO"},codigoMoneda:1,descuentoAdicional:0,detalle:[],detalleExtra:"",detalleExtraText:"",emailCliente:null,numeroTarjeta:null,montoSubTotal:0,montoPagar:0,total:0,inputMontoPagar:0,inputVuelto:0},To=Q({actividadEconomica:Q({codigoActividad:B().required()}),tipoCliente:B().required(),cliente:Q({codigoCliente:B().required()}).nullable().required(),emailCliente:B().email().nullable().required()}),Fo=o=>{const{form:{control:t,setValue:i,reset:r,getValues:m,formState:{errors:l,isSubmitted:h,isSubmitSuccessful:g}}}=o,{user:a}=_(),[y,A]=p.useState(null),{actividades:f,actIsError:d,actError:x,actLoading:P}=Ze();return p.useEffect(()=>{if(!P&&f&&f.length>0&&H(m("actividadEconomica"))){const S=f.find(v=>v.codigoActividad===a.actividadEconomica.codigoCaeb);S?i("actividadEconomica",S):i("actividadEconomica",f[0])}},[P]),d?e.jsx(Te,{mensaje:x==null?void 0:x.message}):e.jsx(e.Fragment,{children:e.jsx(se,{children:P?e.jsx(ne,{}):e.jsx(W,{name:"actividadEconomica",control:t,render:({field:S})=>{var v;return e.jsxs(R,{fullWidth:!0,error:!!l.actividadEconomica,children:[e.jsx(L,{shrink:!0,children:"Actividad Económica"}),e.jsx(J,{...S,styles:K(!!y),name:"actividadEconomica",placeholder:"Seleccione la actividad económica",value:S.value,onChange:async u=>{S.onChange(u),i("detalle",[])},onBlur:async u=>{S.onBlur()},isSearchable:!1,options:f,getOptionValue:u=>u.codigoActividad,getOptionLabel:u=>`${u.tipoActividad} - ${u.codigoActividad} - ${u.actividadEconomica}`}),l.actividadEconomica&&e.jsx(Y,{children:(v=l.actividadEconomica)==null?void 0:v.message})]})}})})})},Mo=N`
  query CLIENTES_BUSQUEDA($query: String!) {
    clienteBusqueda(query: $query) {
      _id
      apellidos
      codigoCliente
      complemento
      email
      nombres
      numeroDocumento
      razonSocial
      tipoDocumentoIdentidad {
        codigoClasificador
        descripcion
      }
      state
    }
  }
`,Bo=async o=>{try{const t=new U("https://sandbox.isipass.net/api"),i=localStorage.getItem(V);return t.setHeader("authorization",`Bearer ${i}`),(await t.request(Mo,{query:o})).clienteBusqueda}catch(t){throw new ce(t)}},ko=[{accessorKey:"codigoCliente",header:"Código Cliente",size:120},{accessorKey:"razonSocial",header:"Razon Social"},{accessorFn:o=>`${o.numeroDocumento}${o.complemento?`-${o.complemento}`:""}`,id:"numeroDocumento",header:"Nro. Documento",size:120},{id:"email",header:"Correo",accessorKey:"email"},{accessorKey:"tipoDocumentoIdentidad.descripcion",id:"tipoDocumentoIdentidad.descripcion",header:"Tipo Documento"}],qo=o=>{const{setRowCliente:t}=o,[i,r]=p.useState(0),[m,l]=p.useState([]),[h,g]=p.useState([]),[a,y]=p.useState({pageIndex:X.page,pageSize:X.limit}),{data:A,isError:f,isLoading:d,isFetching:x}=ee({queryKey:["client",m,a.pageIndex,a.pageSize,h],queryFn:async()=>{const S=De(m),v={...X,page:a.pageIndex+1,limit:a.pageSize,reverse:h.length<=0,query:S},{pageInfo:u,docs:j}=await Co(v);return r(u.totalDocs),j},refetchOnWindowFocus:!1,refetchInterval:!1}),P=p.useMemo(()=>ko,[]);return e.jsx(e.Fragment,{children:e.jsx(Be,{...ke,columns:P,data:A??[],initialState:{showColumnFilters:!0},manualPagination:!0,manualFiltering:!0,manualSorting:!0,muiToolbarAlertBannerProps:f?{color:"error",children:"Error loading data"}:void 0,enableDensityToggle:!1,enableGlobalFilter:!1,onColumnFiltersChange:l,onPaginationChange:y,onSortingChange:g,rowCount:i??0,state:{columnFilters:m,isLoading:d,pagination:a,showAlertBanner:f,showProgressBars:x,sorting:h,density:"compact"},muiTableContainerProps:{sx:{maxHeight:"650px"}},enableRowActions:!0,positionActionsColumn:"last",renderRowActions:({row:S})=>e.jsx("div",{style:{display:"flex",flexWrap:"nowrap",gap:"0.5rem"},children:e.jsx(F,{startIcon:e.jsx(Je,{}),variant:"outlined",color:"primary",size:"small",onClick:()=>{t(S.original)},sx:{width:"80px",height:"28px",fontSize:"0.8rem"},children:"Sel."})})})})},Oo=Ye(eo)(({theme:o})=>({backdropFilter:"blur(5px)",backgroundColor:"rgba(255, 255, 255, 0.5)",zIndex:o.zIndex.drawer+1})),$o=o=>{const{onClose:t,open:i,...r}=o,[m,l]=p.useState(null);p.useEffect(()=>{m&&t(m)},[m]),p.useEffect(()=>{i&&l(null)},[i]);const h=()=>{t()},g=a=>{a.key==="Escape"&&t()};return e.jsx(e.Fragment,{children:e.jsxs(le,{sx:{"& .MuiDialog-paper":{width:"100%",maxHeight:"100%"}},maxWidth:"xl",open:i,onClose:h,onKeyDown:g,BackdropComponent:Oo,...r,children:[e.jsx(de,{children:"Explorar Clientes"}),e.jsx(ue,{sx:{overflow:"hidden"},dividers:!0,children:e.jsx(qo,{setRowCliente:l})}),e.jsx(me,{children:e.jsx(F,{autoFocus:!0,color:"error",size:"small",variant:"contained",onClick:h,children:"Cerrar"})})]})})},zo=o=>{var P,S,v;const{form:{control:t,watch:i,setValue:r,getValues:m,formState:{errors:l}}}=o,[h,g]=p.useState(!1),[a,y]=p.useState(!1),[A,f]=p.useState(!1),d=i(),x=async u=>{try{if(u.length>2){const j=await Bo(u);if(j)return j}return[]}catch(j){return Ce(j),[]}};return e.jsxs(e.Fragment,{children:[e.jsxs(C,{container:!0,spacing:1,rowSpacing:3,children:[e.jsx(C,{item:!0,xs:12,lg:8,sm:12,md:12,children:e.jsx(W,{name:"cliente",control:t,render:({field:u})=>{var j;return e.jsxs(R,{fullWidth:!0,error:!!l.cliente,children:[e.jsx(L,{shrink:!0,children:"Búsqueda de clientes"}),e.jsx(we,{...u,cacheOptions:!1,defaultOptions:!0,styles:K(!!l.cliente),menuPosition:"fixed",name:"clientes",placeholder:"Seleccione Cliente",loadOptions:x,isClearable:!0,value:u.value||null,getOptionValue:n=>n.codigoCliente,getOptionLabel:n=>`${n.numeroDocumento}${n.complemento||""} - ${n.razonSocial} - ${n.tipoDocumentoIdentidad.descripcion}`,onChange:n=>{u.onChange(n),r("emailCliente",Z(n==null?void 0:n.email,""))},onBlur:u.onBlur,noOptionsMessage:()=>"Ingrese referencia -> Razón Social, Código Cliente, Número documento",loadingMessage:()=>"Buscando..."}),e.jsx(Y,{children:(j=l.cliente)==null?void 0:j.message})]})}})}),e.jsx(C,{item:!0,lg:4,xs:12,md:3,children:e.jsx(F,{variant:"outlined",fullWidth:!0,onClick:()=>y(!0),startIcon:e.jsx(oo,{}),children:"Explorar Clientes"})}),e.jsx(C,{item:!0,lg:5,xs:12,md:8,children:e.jsx(W,{control:t,name:"emailCliente",render:({field:u})=>{var j;return e.jsx(ae,{...u,error:!!l.emailCliente,fullWidth:!0,name:"emailCliente",size:"small",label:"Correo Electrónico Alternativo",value:u.value||"",disabled:!m("cliente"),onChange:u.onChange,onBlur:u.onBlur,helperText:(j=l.emailCliente)==null?void 0:j.message})}})}),e.jsx(C,{item:!0,lg:3,xs:12,md:3,children:e.jsx(fe,{title:"Nuevo Cliente",children:e.jsx(F,{variant:"outlined",fullWidth:!0,onClick:()=>g(!0),startIcon:e.jsx(Ee,{}),children:"N. Cliente"})})}),e.jsx(C,{item:!0,lg:4,xs:12,md:3,children:e.jsx(fe,{title:"Nuevo Cliente 99001",children:e.jsx(F,{variant:"outlined",fullWidth:!0,onClick:()=>f(!0),startIcon:e.jsx(Ee,{}),children:"N. Cliente 99001"})})}),e.jsx(C,{item:!0,lg:12,children:e.jsxs(ye,{style:{marginTop:-10,marginLeft:10,padding:0},children:[e.jsx($,{style:{padding:0},children:e.jsxs(z,{children:[e.jsx("strong",{children:"Nombre/Razón Social:"}),"  "," ",((P=d.cliente)==null?void 0:P.razonSocial)||""]})}),e.jsx($,{style:{padding:0},children:e.jsxs(z,{children:[e.jsx("strong",{children:"NIT/CI/CEX:"}),"  "," ",((S=d.cliente)==null?void 0:S.numeroDocumento)||""," ",((v=d.cliente)==null?void 0:v.complemento)||""]})}),e.jsx($,{style:{padding:0},children:e.jsxs(z,{children:[e.jsx("strong",{children:"Correo:"}),"   ",d.emailCliente||""]})})]})})]}),e.jsx(e.Fragment,{children:e.jsx(yo,{id:"nuevoClienteDialog",keepMounted:!1,open:h,onClose:async u=>{u&&(r("cliente",u),r("emailCliente",u.email),await x(u.codigoCliente)),g(!1)}})}),e.jsx(e.Fragment,{children:e.jsx($o,{id:"explorarClienteDialog",keepMounted:!1,open:a,onClose:async u=>{u&&(r("cliente",u),r("emailCliente",u.email),await x(u.codigoCliente)),y(!1)}})}),e.jsx(e.Fragment,{children:e.jsx(bo,{id:"explorarClienteDialog99001",keepMounted:!1,open:A,onClose:async u=>{u&&(r("cliente",u),r("emailCliente",u.email),await x(u.codigoCliente)),f(!1)}})})]})},Ro=N`
  query BUSQUEDA($query: String!) {
    iceProductoBusqueda(query: $query) {
      state
      codigoProducto
      nombre
      descripcion
      actividadEconomica {
        codigoCaeb
        descripcion
        tipoActividad
      }
      descripcionHtml
      tipoProducto {
        _id
        descripcion
        codigoParent
      }
      imagen {
        altText
        url
      }
      proveedor {
        codigo
        nombre
        correo
      }
      sinProductoServicio {
        codigoActividad
        codigoProducto
        descripcionProducto
      }
      precio
      precioComparacion
      costo
      unidadMedida {
        codigoClasificador
        descripcion
      }
      alicuotaEspecifica
      alicuotaPorcentual
      alicuotaDescripcion
      marcaIce
      subPartidaArancelaria
    }
  }
`,Lo=async o=>{const t=new U("https://sandbox.isipass.net/api"),i=localStorage.getItem(V);t.setHeader("authorization",`Bearer ${i}`);const r=await t.request(Ro,{query:o});return(r==null?void 0:r.iceProductoBusqueda)||[]},Vo=N`
  query EXP_PRODUCTO_LISTADO(
    $limit: Int!
    $reverse: Boolean
    $page: Int!
    $query: String
  ) {
    iceProductoListado(limit: $limit, reverse: $reverse, page: $page, query: $query) {
      pageInfo {
        hasNextPage
        hasPrevPage
        limit
        page
        totalDocs
      }
      docs {
        codigoProducto
        state
        nombre
        descripcion
        actividadEconomica {
          codigoCaeb
          descripcion
          tipoActividad
        }
        descripcionHtml
        tipoProducto {
          _id
          descripcion
          codigoParent
        }
        imagen {
          altText
          url
        }
        proveedor {
          codigo
          nombre
          correo
        }
        sinProductoServicio {
          codigoActividad
          codigoProducto
          descripcionProducto
        }
        precio
        precioComparacion
        costo
        unidadMedida {
          codigoClasificador
          descripcion
        }
        marcaIce
        subPartidaArancelaria
        alicuotaDescripcion
        alicuotaEspecifica
        alicuotaPorcentual
        state
        usucre
        createdAt
        usumod
        updatedAt
      }
    }
  }
`,No=async o=>{const t=new U("https://sandbox.isipass.net/api"),i=localStorage.getItem(V);t.setHeader("authorization",`Bearer ${i}`);const r=await t.request(Vo,{...o});return(r==null?void 0:r.iceProductoListado)||[]},Uo=o=>{_();const t=p.useMemo(()=>[{accessorKey:"codigoProducto",header:"Código Producto",size:100},{accessorKey:"nombre",header:"Producto / Servicio"},{accessorKey:"unidadMedida.descripcion",header:"Unidad Medida",enableColumnFilter:!1},{accessorKey:"marcaIce",header:"Marca ICE",id:"marcaIce",size:135,accessorFn:j=>j.marcaIce===1?"SI":j.marcaIce===2?"NO":""},{accessorKey:"subPartidaArancelaria",header:"Sub Partida Arancelaria"},{accessorKey:"alicuotaDescripcion",header:"Alicuota"},{accessorKey:"alicuotaEspecifica",header:"Alicuota Especifica"},{accessorKey:"alicuotaPorcentual",header:"Alicuota Porcentual"},{accessorKey:"precio",header:"Precio",muiTableBodyCellProps:{align:"right"},accessorFn:j=>M(j.precio,{}),size:100},{accessorKey:"sinProductoServicio.codigoActividad",header:"Código Actividad",enableColumnFilter:!1}],[]),{setProductosVariantes:i,codigoActividad:r}=o,[m,l]=p.useState(0),[h,g]=p.useState([]),[a,y]=p.useState([]),[A,f]=p.useState({pageIndex:X.page,pageSize:X.limit}),[d,x]=p.useState({}),{data:P,isError:S,isFetching:v,isLoading:u}=ee({queryKey:["tableProductoVarianteDialog",h,A.pageIndex,A.pageSize,a],queryFn:async()=>{const j=De(h,[]),n={...X,page:A.pageIndex+1,limit:A.pageSize,reverse:a.length<=0,query:j},{pageInfo:b,docs:I}=await No(n);return l(b.totalDocs),I},refetchOnWindowFocus:!1,refetchInterval:!1});return p.useEffect(()=>{if(d){const j=Object.keys(d);if(P){const n=P.filter(b=>j.includes(b.codigoProducto));i(n)}}},[d,P,i]),e.jsx(e.Fragment,{children:e.jsx("div",{style:{maxHeight:"500px",overflowY:"auto"},children:e.jsx(Be,{...ke,columns:t,data:P??[],initialState:{showColumnFilters:!1},manualFiltering:!0,manualPagination:!0,manualSorting:!0,enableRowActions:!1,muiToolbarAlertBannerProps:S?{color:"error",children:"Error en cargar los datos"}:void 0,onColumnFiltersChange:g,onPaginationChange:f,onSortingChange:y,enableDensityToggle:!1,enableGlobalFilter:!1,rowCount:m??0,state:{isLoading:u,columnFilters:h,pagination:A,showAlertBanner:S,showProgressBars:v,sorting:a,density:"compact",rowSelection:d},enableRowSelection:!0,onRowSelectionChange:x,getRowId:j=>j.codigoProducto,muiTableContainerProps:{sx:{maxHeight:"650px"}},muiTableBodyRowProps:({row:j})=>({onClick:j.getToggleSelectedHandler(),sx:{cursor:"pointer"}})})})})},Wo=o=>{const{onClose:t,codigoActividad:i,open:r,...m}=o,[l,h]=p.useState([]),g=()=>{l.length>0&&t(l)};return e.jsx(e.Fragment,{children:e.jsxs(le,{sx:{"& .MuiDialog-paper":{width:"100%",maxHeight:750}},maxWidth:"xl",open:r,...m,children:[e.jsx(de,{children:"Explorar Servicios"}),e.jsx(ue,{dividers:!0,children:e.jsx(Uo,{codigoActividad:i,setProductosVariantes:h})}),e.jsxs(me,{style:{justifyContent:"center",marginLeft:10},children:[e.jsx(F,{autoFocus:!0,color:"error",size:"small",variant:"contained",onClick:()=>t(),children:"Cerrar"}),e.jsx(F,{sx:{mr:2},disabled:l.length===0,autoFocus:!0,color:"primary",size:"small",variant:"contained",onClick:()=>g(),children:"Adicionar Servicio"})]})]})})},Ko=o=>o.detalle.length>0&&o.detalle.reduce((t,i)=>t+i.cantidad*i.precioUnitario-i.montoDescuento,0)||0,ze=o=>{const t=Ko(o),i=t-o.descuentoAdicional,r=t-Z(o.descuentoAdicional,0),m=o.inputMontoPagar-r;return{subTotal:t,total:i,montoPagar:r,vuelto:m}},_o=N`
  query PRODUCTO_SERVICIO_POR_ACTIVIDAD_UNIDAD_MEDIDA($codigoDocumentoSector: Int!) {
    sinProductoServicioPorDocumentoSector(codigoDocumentoSector: $codigoDocumentoSector) {
      codigoActividad
      codigoProducto
      descripcionProducto
    }
    sinUnidadMedida {
      codigoClasificador
      descripcion
    }
  }
`,Go=async()=>{try{const o=new U("https://sandbox.isipass.net/api"),t=localStorage.getItem(V),i=parseInt("14");return o.setHeader("authorization",`Bearer ${t}`),await o.request(_o,{codigoDocumentoSector:i})}catch(o){throw new ce(o)}},Ho=o=>{const{onClose:t,keepMounted:i,codigoActividad:r,open:m,...l}=o,{user:h}=_(),g={incluirCantidad:!1,verificarStock:!1,id:ve(5),codigoProducto:ve(10).toUpperCase(),marcaIce:1,alicuotaEspecifica:"",alicuotaPorcentual:"",nombre:"",precio:0,titulo:"",inventario:[{sucursal:h.sucursal,stock:0}],costo:0,sinProductoServicio:{},unidadMedida:{},precioComparacion:0,disponibleParaVenta:!1,codigoBarras:null},[a,y]=p.useState(g),[A,f]=p.useState([]),[d,x]=p.useState([]),[P,S]=p.useState(null),v=()=>{t()},u=()=>{try{if(a.titulo.trim().length===0)throw new Error("Debe ingresar título del producto");if(a.nombre.trim().length===0)throw new Error("Debe ingresar nombre del producto");if(a.precio===0)throw new Error("Precio debe ser mayor a 0");if(H(a.unidadMedida))throw new Error("Seleccione unidad de medida");if(H(a.sinProductoServicio))throw new Error("Seleccione producto para homologación");if(H(a.marcaIce))throw new Error("Debe ingresar marca ICE");if(a.marcaIce===1&&(H(a.alicuotaEspecifica)||H(a.alicuotaPorcentual)))throw new Error("Debe ingresar alicuota especifica y porcentual");const n={_id:a.id,id:a.id,sinProductoServicio:a.sinProductoServicio,codigoProducto:a.codigoProducto,marcaIce:parseInt(a.marcaIce),...a.marcaIce===1?{alicuotaEspecifica:parseFloat(a.alicuotaEspecifica),alicuotaPorcentual:parseFloat(a.alicuotaPorcentual)}:{},titulo:a.titulo,nombre:a.nombre,codigoBarras:null,precio:a.precio,precioComparacion:a.precioComparacion,costo:a.costo,incluirCantidad:!1,verificarStock:!1,unidadMedida:a.unidadMedida,inventario:a.inventario,usucre:h.nombres};t(n)}catch(n){Oe(n.message)}},j=async()=>{try{const n=await Go();n&&(f(n.sinUnidadMedida),x(n.sinProductoServicioPorDocumentoSector))}catch(n){S(n.message)}};return p.useEffect(()=>{j().then()},[]),p.useEffect(()=>{m&&y(g)},[m]),e.jsx(e.Fragment,{children:e.jsxs(le,{sx:{"& .MuiDialog-paper":{width:"80%",maxHeight:490}},maxWidth:"sm",keepMounted:!1,open:m,...l,children:[e.jsx(de,{children:"Agregar Producto/Servicio Personalizado"}),e.jsx(ue,{dividers:!0,children:P?e.jsx(Te,{mensaje:P}):e.jsxs(C,{container:!0,spacing:2.5,children:[e.jsx(C,{item:!0,lg:12,md:12,xs:12,children:e.jsxs(R,{fullWidth:!0,component:"div",children:[e.jsx(L,{shrink:!0,children:"Tipo de Producto Homologado"}),e.jsx(J,{styles:K(!!P),menuPosition:"fixed",name:"productoServicio",placeholder:"Seleccione producto para homologación",value:Z(a.sinProductoServicio,null),onChange:n=>{y({...a,sinProductoServicio:n||{}})},options:d,getOptionValue:n=>n.codigoProducto,getOptionLabel:n=>`${n.codigoProducto} - ${n.descripcionProducto}`})]})}),e.jsx(C,{item:!0,lg:12,md:12,xs:12,children:e.jsxs(R,{fullWidth:!0,component:"div",children:[e.jsx(L,{shrink:!0,children:"Unidad Medida"}),e.jsx(J,{styles:K(!!P),menuPosition:"fixed",name:"unidadMedida",placeholder:"Seleccione la unidad de medida",value:Z(a.unidadMedida,null),onChange:n=>{y({...a,unidadMedida:n||{}})},options:A,getOptionLabel:n=>`${n.codigoClasificador} - ${n.descripcion}`})]})}),e.jsx(C,{item:!0,lg:4,md:4,sm:4,xs:12,children:e.jsx(to,{control:e.jsx(ao,{checked:a.marcaIce===1,onChange:n=>{const b=n.target.checked?1:2;y(b===2?{...a,marcaIce:b,alicuotaEspecifica:0,alicuotaPorcentual:0}:{...a,marcaIce:b})},inputProps:{"aria-label":"Marca Ice"}}),label:"Marca Ice"})}),e.jsx(C,{item:!0,lg:4,md:4,sm:4,xs:12,children:e.jsx(ae,{id:"alicuotaEspecifica",label:"Alicuota Especifica",type:"number",size:"small",fullWidth:!0,value:a.alicuotaEspecifica,onChange:n=>{let b=n.target.value.trim();if(b=b.replace(/,/g,""),/^\d+(\.\d{0,5})?$/.test(b)||b===""){const I=b===""?"":parseFloat(b);(I===""||I>=0&&I<=1e7)&&y({...a,alicuotaEspecifica:I})}},disabled:a.marcaIce===2})}),e.jsx(C,{item:!0,lg:4,md:4,sm:4,xs:12,children:e.jsx(ae,{id:"alicuotaPorcentual",label:"Alicuota Porcentual",size:"small",fullWidth:!0,type:"number",value:a.alicuotaPorcentual,onChange:n=>{let b=n.target.value.trim();if(b=b.replace(/,/g,""),/^\d+(\.\d{0,5})?$/.test(b)||b===""){const I=b===""?"":parseFloat(b);(I===""||I>=0&&I<=100)&&y({...a,alicuotaPorcentual:I})}},InputProps:{endAdornment:e.jsx(io,{position:"end",children:"%"})},disabled:a.marcaIce===2})}),e.jsx(C,{item:!0,lg:12,md:12,sm:12,xs:12,children:e.jsx(ae,{id:"nombre",label:"Nombre / Descripción Servicio",multiline:!0,minRows:3,maxRows:6,size:"small",fullWidth:!0,value:a.nombre,onChange:n=>{y({...a,nombre:n.target.value,titulo:n.target.value})}})}),e.jsxs(C,{item:!0,lg:12,md:12,xs:12,children:[e.jsx(Fe,{children:"Precio"}),e.jsx(be,{min:0,value:a.precio,onFocus:Ge,onChange:n=>y({...a,precio:n}),formatter:M,style:{width:"100%"}})]})]})}),e.jsxs(me,{sx:{mb:1},children:[e.jsx(F,{variant:"contained",size:"small",onClick:u,children:"Registrar"}),e.jsx(F,{variant:"contained",size:"small",color:"error",autoFocus:!0,onClick:v,style:{marginRight:18},children:"Cancelar"})]})]})})},he=o=>{try{return typeof o=="number"?o:parseFloat(o.toString())}catch{return null}},Qo=o=>{const[t,i]=p.useState(""),{form:{control:r,setValue:m,getValues:l,formState:{errors:h}}}=o,{user:g}=_(),a=g.monedaTienda,{fields:y,append:A,prepend:f,remove:d,insert:x,update:P}=Ue({control:r,name:"detalle"}),[S,v]=p.useState(!1),[u,j]=p.useState(!1),[n]=p.useState(null),b=c=>c.target.select(),I=async c=>{c&&f({...c,codigoProductoSin:c.sinProductoServicio.codigoProducto,cantidad:1,cantidadIce:1,precioUnitario:c.precio,montoDescuento:0,subtotal:0})},ge=(c,D)=>{P(c,D)},oe=async c=>{try{if(c.trim().length>=1){const D=await Lo(c);if(D)return D}return[]}catch(D){return Ce(D),[]}};return p.useEffect(()=>{const c=ze(l());m("montoSubTotal",c.subTotal),m("montoPagar",c.montoPagar),m("inputVuelto",c.vuelto),m("total",c.total)},[y]),p.useEffect(()=>{l("actividadEconomica")&&oe("").then()},[l("actividadEconomica")]),l("actividadEconomica.codigoActividad")?e.jsxs(e.Fragment,{children:[e.jsx(se,{title:"Servicios",children:e.jsxs(C,{container:!0,spacing:1,children:[e.jsx(C,{item:!0,xs:12,lg:7,md:7,sm:12,children:e.jsxs(R,{fullWidth:!0,children:[e.jsx(L,{shrink:!0,children:"Búsqueda de Servicios"}),e.jsx(we,{cacheOptions:!1,defaultOptions:!1,styles:K(!!n),menuPosition:"fixed",name:"productosServicios",placeholder:"Seleccione Servicio",loadOptions:oe,isClearable:!0,value:null,getOptionValue:c=>c.codigoProducto,getOptionLabel:c=>`${c.codigoProducto} - ${c.nombre}`,onChange:c=>I(c),noOptionsMessage:()=>"Ingrese referencia al Producto/Servicio deseado",loadingMessage:()=>"Buscando..."})]})}),e.jsx(C,{item:!0,xs:12,md:5,lg:5,children:e.jsxs(Me,{direction:{xs:"column",sm:"row"},spacing:1,children:[e.jsx(F,{variant:"outlined",onClick:()=>j(!0),children:"Explorar Servicios"}),e.jsx(F,{onClick:()=>v(!0),variant:"outlined",children:"Servicio Personalizado"})]})}),e.jsxs(C,{item:!0,xs:12,md:5,lg:5,children:[e.jsx("div",{style:{display:"flex",alignItems:"center"},children:e.jsx("span",{style:{marginRight:"8px",fontWeight:"bold",fontSize:"15px"}})}),t&&e.jsxs("div",{style:{marginTop:"8px"},children:[e.jsx("span",{style:{fontWeight:"bold",fontSize:"15px"},children:"Período Seleccionado:"})," ",t]})]}),e.jsx(C,{item:!0,xs:12,children:e.jsx("div",{className:"responsive-table",style:{marginTop:20},children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",style:{width:400},children:"Producto"}),e.jsx("th",{scope:"col",style:{width:160},children:"Cantidad"}),e.jsxs("th",{scope:"col",style:{width:160},children:["Precio (",a.sigla,")"]}),e.jsxs("th",{scope:"col",style:{width:160},children:["Descuento (",a.sigla,")"]}),e.jsxs("th",{scope:"col",style:{width:150},children:["SUB Total (",a.sigla,")"]}),e.jsx("th",{scope:"col",style:{width:100},children:"Opciones"})]})}),e.jsx("tbody",{children:y.length>0&&y.map((c,D)=>e.jsxs("tr",{children:[e.jsx("td",{"data-label":"Producto",children:e.jsx(ye,{dense:!0,sx:{width:"400%",maxWidth:360,bgcolor:"background.paper",padding:0},children:e.jsxs($,{alignItems:"flex-start",children:[e.jsx(ro,{children:e.jsx(no,{alt:"Remy Sharp"})}),e.jsx(z,{primary:e.jsx(e.Fragment,{children:e.jsxs(q,{variant:"subtitle2",gutterBottom:!0,children:[c.nombre," ",e.jsx("span",{style:{fontWeight:"normal"},children:c.detalleExtra||""})]})}),secondary:e.jsxs(p.Fragment,{children:[e.jsxs(q,{sx:{display:"inline"},component:"span",variant:"body2",color:"text.primary",children:[`Código: ${c.codigoProducto}`," ",e.jsx("br",{}),`Marca Ice: ${c.marcaIce===1?"Si":"No"}`," ",c.marcaIce!==2&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),`Alicuota Específica: ${c.alicuotaEspecifica}`," ",e.jsx("br",{}),`Alicuota Porcentual: ${c.alicuotaPorcentual} %`," "]})]})," ",e.jsx("br",{}),`${c.unidadMedida.descripcion||""}`]})})]})})}),e.jsx("td",{"data-label":"CANTIDAD",children:e.jsx(ie,{size:"small",value:c.cantidad.toString(),onFocus:b,onChange:w=>{const s=he(w.target.value.toString());s>=0&&P(D,{...c,cantidad:s})},inputComponent:pe,inputProps:{scale:5}})}),e.jsx("td",{"data-label":`PRECIO (${a.sigla})`,children:e.jsx(ie,{size:"small",value:c.precioUnitario.toString(),onFocus:b,onChange:w=>{const s=he(w.target.value.toString());s>=0&&s>=c.montoDescuento?P(D,{...c,precioUnitario:s}):Ie.warn("El precio no puede ser menor al descuento")},inputComponent:pe,inputProps:{scale:5}})}),e.jsx("td",{"data-label":`DESCUENTO (${a.sigla})`,children:e.jsx(ie,{size:"small",value:c.montoDescuento.toString(),onFocus:b,onChange:w=>{const s=he(w.target.value.toString());s<=c.precioUnitario?P(D,{...c,montoDescuento:s}):Ie.warn("El descuento no puede ser mayor al precio")},inputComponent:pe,inputProps:{scale:5}})}),e.jsx("td",{"data-label":`SUB-TOTAL (${a.sigla||""})`,style:{textAlign:"right",backgroundColor:"#fafafa"},children:e.jsx(q,{variant:"subtitle1",gutterBottom:!0,component:"div",children:e.jsx("strong",{children:M(c.cantidad*c.precioUnitario-c.montoDescuento,{})})})}),e.jsxs("td",{"data-label":"OPCIONES",style:{textAlign:"right"},children:[e.jsx(Ae,{onClick:()=>d(D),children:e.jsx(so,{color:"warning"})}),e.jsx(Ae,{onClick:async()=>{const{value:w}=await qe.fire({input:"textarea",inputLabel:"Añadir descripción extra",inputPlaceholder:"Ingrese su descripcion extra...",inputValue:c.detalleExtra||"",inputAttributes:{"aria-label":"Type your message here"},showCancelButton:!0,cancelButtonText:"Cancelar",confirmButtonText:"Agregar Descripción"});ge(D,{...c,detalleExtra:w||""})},children:e.jsx(co,{color:"primary"})})]})]},D))})]})})})]})}),e.jsx(e.Fragment,{children:e.jsx(Ho,{id:"agregarArticulo",keepMounted:!1,open:S,codigoActividad:l("actividadEconomica.codigoActividad"),onClose:c=>{I(c).then(),v(!1)}})}),e.jsx(e.Fragment,{children:e.jsx(Wo,{id:"explorarProductos",keepMounted:!1,open:u,codigoActividad:l("actividadEconomica.codigoActividad"),onClose:c=>{if(c)for(const D of c)I(D).then();j(!1)}})})]}):e.jsx(e.Fragment,{children:e.jsx(ne,{})})},Xo=o=>{const{form:{control:t,setValue:i,getValues:r,formState:{errors:m}},detalleExtra:l}=o;return e.jsx(e.Fragment,{children:e.jsxs(lo,{sx:{backgroundColor:"#EFEFEF"},children:[e.jsx(fe,{title:"Click para Abrir / Cerrar",placement:"top",arrow:!0,children:e.jsx(uo,{expandIcon:e.jsx(mo,{}),"aria-controls":"panel1a-content",children:e.jsx(q,{variant:"subtitle2",children:"DETALLE EXTRA (Click para expandir)"})})}),e.jsx(go,{children:e.jsx(po,{sx:{alignItems:"right",textAlign:"left"},children:e.jsx(Po,{apiKey:"niud727ae46xgl3s5morxk4v03hq6rrv7lpkvustyt2ilp2k",value:r("detalleExtra")||"",onInit:(h,g)=>{g.on("blur",a=>{i("detalleExtraText",g.getContent({format:"text"}))})},onEditorChange:(h,g)=>{i("detalleExtra",g.getContent())},init:{plugins:"table template code",toolbar:"undo redo | bold italic | alignleft aligncenter alignright alignjustify | table | template | code",menubar:!1,table_default_attributes:{border:"none"},min_height:250,height:250,max_height:500,templates:l}})})})]})})},Zo=p.forwardRef(function(t,i){const{onChange:r,...m}=t;return e.jsx(vo,{...m,mask:"0000-\\0\\0\\0\\0-\\0\\0\\0\\0-0000",lazy:!1,inputRef:i,definitions:{0:/[1-9-0]/},unmask:"typed",onAccept:(l,h)=>r({target:{name:t.name,value:l}}),overwrite:!0})}),Jo=N`
  query METODOS_PAGO {
    metodosPago {
      codigoClasificador
      descripcion
    }
  }
`,Yo=async()=>{const o=new U("https://sandbox.isipass.net/api"),t=localStorage.getItem(V);return o.setHeader("authorization",`Bearer ${t}`),(await o.request(Jo)).metodosPago},et=(o=[])=>{const{data:t,isLoading:i,isError:r,error:m}=ee({queryKey:["metodosPago",...o],queryFn:async()=>{const l=await Yo();return l.length>0?l:[]}});return{metodosPago:t,mpLoading:i,mpIsError:r,mpError:m}},ot=o=>{const{form:{control:t,watch:i,setValue:r,getValues:m,formState:{errors:l}}}=o,h=i("codigoMetodoPago"),{metodosPago:g,mpIsError:a,mpError:y,mpLoading:A}=et();return p.useEffect(()=>{h.codigoClasificador===1&&r("numeroTarjeta","")},[h]),e.jsx(e.Fragment,{children:e.jsxs(Me,{spacing:3,pt:2,mt:2,children:[e.jsx(W,{name:"codigoMetodoPago",control:t,render:({field:f})=>{var d;return e.jsxs(R,{fullWidth:!0,error:!!l.codigoMetodoPago,children:[e.jsx(L,{shrink:!0,children:"Método de Págo"}),e.jsx(J,{...f,styles:{...K,control:(x,P)=>({...x,fontWeight:"bold",fontSize:"15px"})},name:"codigoMetodoPago",placeholder:"Seleccione el método de págo",value:f.value,onChange:async x=>{f.onChange(x)},onBlur:async x=>{f.onBlur()},isSearchable:!1,options:g,getOptionValue:x=>x.codigoClasificador.toString(),getOptionLabel:x=>`${x.codigoClasificador} - ${x.descripcion}`}),l.codigoMetodoPago&&e.jsx(Y,{children:(d=l.codigoMetodoPago)==null?void 0:d.message})]})}}),m("codigoMetodoPago").codigoClasificador===2&&e.jsx(e.Fragment,{children:e.jsx(W,{name:"numeroTarjeta",control:t,render:({field:f})=>e.jsxs(R,{fullWidth:!0,size:"small",focused:!0,style:{zIndex:0},children:[e.jsx(Fe,{htmlFor:"formatted-text-mask-input",children:"Ingrese el Número de tarjeta"}),e.jsx(ie,{label:"Ingrese el Número de tarjeta",...f,value:f.value||"",onChange:d=>{const x=So.replace(d.target.value,new RegExp("-","g"),"").replace(/_/g,"").trim();f.onChange(x)},name:"numeroTarjeta",inputComponent:Zo}),e.jsx("small",{children:"Ingrese los primero 4 y últimos 4 dígitos"})]})})})]})})},tt=N`
  query MONEDAS {
    monedas {
      codigo
      sigla
      descripcion
      tipoCambio
      activo
    }
  }
`,at=async()=>{const o=new U("https://sandbox.isipass.net/api"),t=localStorage.getItem(V);return o.setHeader("authorization",`Bearer ${t}`),(await o.request(tt)).monedas},it=N`
  mutation ICE_REGISTRO($notificacion: Boolean, $input: FacturaIceInput!) {
    facturaIceRegistro(notificacion: $notificacion, input: $input) {
      state
      numeroFactura
      representacionGrafica {
        pdf
        rollo
        xml
        sin
      }
      sucursal {
        codigo
      }
      puntoVenta {
        codigo
      }
    }
  }
`,rt=async(o,t)=>{try{const i=new U("https://sandbox.isipass.net/api"),r=localStorage.getItem(V);return i.setHeader("authorization",`Bearer ${r}`),(await i.request(it,{notificacion:o,input:t})).facturaIceRegistro}catch(i){throw console.log("error",i),console.log("error",i.response.errors[0].message),new ce(i)}},xe=(o,t)=>{try{return je(o*t)}catch{return o}},nt=o=>{var i;const t={actividadEconomica:(i=o.actividadEconomica)==null?void 0:i.codigoActividad,cliente:{codigoCliente:o.cliente.codigoCliente,email:o.cliente.email},codigoMetodoPago:o.codigoMetodoPago.codigoClasificador,descuentoAdicional:xe(o.descuentoAdicional,o.tipoCambio),codigoMoneda:o.moneda.codigo,tipoCambio:o.tipoCambio,detalleExtra:o.detalleExtra,detalle:o.detalle.map(r=>{var m;return{codigoActividad:(m=o.actividadEconomica)==null?void 0:m.codigoActividad,codigoProductoSin:r.codigoProductoSin,codigoProducto:r.codigoProducto,descripcionProducto:r.nombre,cantidad:r.cantidad,unidadMedida:parseInt(r.unidadMedida.codigoClasificador.toString()),montoDescuento:xe(r.montoDescuento,o.tipoCambio),marcaIce:r.marcaIce,precioUnitario:xe(r.precioUnitario,o.tipoCambio),...r.marcaIce===2?{}:{cantidadIce:r.cantidad,alicuotaEspecifica:r.alicuotaEspecifica,alicuotaPorcentual:r.alicuotaPorcentual}}})};return o.numeroTarjeta?{...t,numeroTarjeta:o.numeroTarjeta}:t},st=async o=>(await Q({actividadEconomica:B().required("Debe seleccionar la actividad economica"),cliente:Q({codigoCliente:B().required("Debe seleccionar los datos del cliente"),email:B().email("Debe ingresar un correo valido")}),codigoMetodoPago:G().integer().min(1).max(308).required(),detalleExtra:B().min(0).max(500),tipoCambio:G().min(0),numeroTarjeta:B().max(16),detalle:Xe().of(Q({codigoProductoSin:B().min(1).max(99999999).required(),codigoProducto:B().min(1).max(50).required(),descripcionProducto:B().min(1).max(500).required(),cantidad:G().min(0).required(),unidadMedida:G().integer().min(1).required(),precioUnitario:G().min(0).required(),montoDescuento:G().min(0)})).min(1,"Debe seleccionar al menos 1 productos / servicio para el detalle")}).validate(o),!0),ct=o=>{const{user:{monedaTienda:t}}=_(),{onClose:i,keepMounted:r,value:m,open:l,...h}=o,[g,a]=p.useState(m),y=p.useRef(null);p.useEffect(()=>{l||a(m)},[m,l]);const A=()=>{i()},f=()=>{i(g)},d=()=>{y.current!=null&&y.current.focus()};return e.jsxs(le,{sx:{"& .MuiDialog-paper":{width:"80%",maxHeight:435}},maxWidth:"xs",keepMounted:r,TransitionProps:{onEntering:d},open:l,...h,children:[e.jsxs(de,{children:["Ingrese Descuento Adicional (",t.descripcion,")"]}),e.jsx(ue,{dividers:!0,children:e.jsx(C,{container:!0,children:e.jsxs(C,{item:!0,lg:12,children:[e.jsx(be,{min:0,value:g,onFocus:x=>x.target.select(),onChange:x=>a(x),formatter:M}),e.jsx(q,{variant:"subtitle1",sx:{ml:1},component:"small",children:t.sigla||""})]})})}),e.jsxs(me,{children:[e.jsx(F,{autoFocus:!0,onClick:A,children:"Cancelar"}),e.jsx(F,{onClick:f,style:{marginRight:10},children:"Aceptar"})]})]})},lt=o=>{const{user:{moneda:t,monedaTienda:i}}=_(),{form:{control:r,reset:m,handleSubmit:l,setValue:h,getValues:g,formState:{errors:a}}}=o,[y,A]=p.useState(!1),f=Eo(qe),d=g("moneda"),x=g("tipoCambio"),P=g("detalle");g("total");const S=g("descuentoAdicional");let v=0,u=0,j=0,n=0;P.forEach((s,T)=>{const E=(s==null?void 0:s.cantidad)||0,O=(s==null?void 0:s.precioUnitario)||0,k=(s==null?void 0:s.montoDescuento)||0,te=(s==null?void 0:s.alicuotaEspecifica)||0,Re=((s==null?void 0:s.alicuotaPorcentual)||0)/100,Le=(E*O-k)*.13,Pe=(E*O-k-Le)*Re;j+=Pe;const Se=E*te;u+=Se;const Ve=E*O-k+(Pe+Se);v+=Ve,n+=k}),p.useState(!1);const b=s=>s.target.select(),I=async s=>{const T=nt(s),E=!0;await st(T).catch(k=>{Oe(k.message)})&&await He({text:"¿Confirma que desea emitir el documento fiscal?",preConfirm:()=>rt(E,T).catch(k=>(Ce(k),!1))}).then(k=>{if(k.isConfirmed){const{value:te}=k;m({...$e,actividadEconomica:s.actividadEconomica}),Qe(te.representacionGrafica.pdf),f.fire({title:"Documento generado correctamente",html:e.jsx(Ao,{representacionGrafica:te.representacionGrafica})})}})},{data:ge,isLoading:oe,isError:c,error:D}=ee({queryKey:["apiMonedas"],queryFn:async()=>{const s=await at();if(s.length>0){const T=s.find(O=>O.codigo===Z(d==null?void 0:d.codigo,t.codigo)),E=s.find(O=>O.codigo===i.codigo);return T&&E&&(h("moneda",T),h("tipoCambio",E.tipoCambio)),s}return[]}}),w=s=>{try{return je(s*x/je(d.tipoCambio))}catch{return s}};return p.useEffect(()=>{const s=ze(g());h("montoSubTotal",s.subTotal),h("montoPagar",s.montoPagar);const T=g("inputMontoPagar");h("inputVuelto",v-S-n-T)},[g("descuentoAdicional"),g("inputMontoPagar"),g("detalle"),g("moneda")]),e.jsx(e.Fragment,{children:e.jsxs(se,{title:"Cálculo de los totales",childIcon:e.jsx(ho,{}),children:[oe?e.jsx(ne,{}):e.jsx(W,{name:"moneda",control:r,render:({field:s})=>{var T;return e.jsxs(R,{fullWidth:!0,error:!!a.moneda,children:[e.jsx(L,{shrink:!0,children:"Moneda de venta"}),e.jsx(J,{...s,styles:K(!!a.moneda),name:"moneda",placeholder:"Seleccione la moneda de venta",value:s.value,onChange:async E=>{s.onChange(E)},onBlur:async E=>{s.onBlur()},isSearchable:!1,options:ge,getOptionValue:E=>E.codigo.toString(),getOptionLabel:E=>`${E.descripcion} (${E.sigla}) - ${M(E.tipoCambio,{})}`}),a.moneda&&e.jsx(Y,{children:(T=a.moneda)==null?void 0:T.message})]})}}),e.jsxs(ye,{dense:!0,sx:{mt:2},children:[e.jsx(re,{}),e.jsx($,{style:{padding:0},secondaryAction:e.jsxs(q,{variant:"subtitle1",gutterBottom:!0,children:[M(w(v||0),{}),e.jsxs("span",{style:{fontSize:"0.8em"},children:[" ",(d==null?void 0:d.sigla)||""]})]}),children:e.jsx(z,{primary:e.jsx("strong",{children:"SUB-TOTAL"})})}),e.jsx($,{style:{padding:0},secondaryAction:e.jsxs(e.Fragment,{children:[e.jsxs(xo,{href:"#",onClick:()=>A(!0),variant:"subtitle1",underline:"hover",children:[M(w(g("descuentoAdicional"))||0,{}),e.jsxs("span",{style:{fontSize:"0.8em"},children:[" ",(d==null?void 0:d.sigla)||""]})]}),e.jsx(ct,{id:"ringtone-menu",keepMounted:!1,open:y,onClose:s=>{A(!1),(s||s===0)&&h("descuentoAdicional",s)},value:g("descuentoAdicional")||0})]}),children:e.jsx(z,{primary:e.jsx("strong",{children:"DESCUENTO ADICIONAL"})})}),e.jsx($,{style:{padding:0},secondaryAction:e.jsxs(q,{variant:"subtitle1",gutterBottom:!0,children:[M(w(v-S),{maximumFractionDigits:2}),e.jsxs("span",{style:{fontSize:"0.8em"},children:[" ",(d==null?void 0:d.sigla)||""]})]}),children:e.jsx(z,{primary:e.jsx("strong",{children:"TOTAL"})})}),e.jsx($,{style:{padding:0},secondaryAction:e.jsxs(q,{variant:"subtitle1",gutterBottom:!0,children:[M(w(u),{maximumFractionDigits:2}),e.jsxs("span",{style:{fontSize:"0.8em"},children:[" ",(d==null?void 0:d.sigla)||""]})]}),children:e.jsx(z,{primary:e.jsx("strong",{children:"TOTAL ICE ESPECÍFICO"})})}),e.jsx($,{style:{padding:0},secondaryAction:e.jsxs(q,{variant:"subtitle1",gutterBottom:!0,children:[M(w(j),{maximumFractionDigits:2}),e.jsxs("span",{style:{fontSize:"0.8em"},children:[" ",(d==null?void 0:d.sigla)||""]})]}),children:e.jsx(z,{primary:e.jsx("strong",{children:"TOTAL ICE PORCENTUAL"})})}),e.jsx(re,{variant:"inset",component:"li",style:{marginTop:10,marginBottom:20}}),e.jsx($,{style:{padding:0},secondaryAction:e.jsxs(q,{variant:"h6",gutterBottom:!0,children:[M(w(v-S-n),{}),e.jsxs("span",{style:{fontSize:"0.8em"},children:[" ",(d==null?void 0:d.sigla)||""]})]}),children:e.jsx(z,{primary:e.jsx("strong",{children:"MONTO A PAGAR"})})})]}),e.jsx(re,{style:{marginTop:10,marginBottom:20},color:"red"}),e.jsxs(C,{sx:{flexGrow:1},container:!0,spacing:3,children:[e.jsx(C,{item:!0,xs:12,md:7,lg:7,children:e.jsx(W,{control:r,name:"inputMontoPagar",render:({field:s})=>{var T,E;return e.jsxs(R,{fullWidth:!0,error:!!((T=a.inputMontoPagar)!=null&&T.message),children:[e.jsx(L,{shrink:!0,children:"Ingrese Monto"}),e.jsx(be,{...s,min:0,id:"montoPagar",className:"inputMontoPagar",value:s.value,onFocus:b,onChange:O=>{s.onChange(O)},formatter:M}),e.jsx(Y,{children:(E=a.inputMontoPagar)==null?void 0:E.message})]})}})}),e.jsxs(C,{item:!0,xs:12,md:5,lg:5,children:[e.jsx("small",{children:"Vuelto / Saldo"}),e.jsx(q,{variant:"h6",gutterBottom:!0,mr:2,align:"right",color:"red",children:M(w(g("inputVuelto")||0),{})})]}),e.jsx(C,{item:!0,xs:12,md:12,lg:12,children:e.jsx(F,{variant:"contained",onClick:l(I),fullWidth:!0,color:"success",startIcon:e.jsx(jo,{}),children:"REALIZAR PAGO"})})]})]})})},Da=()=>{const{user:o}=_(),t=We({defaultValues:{...$e},resolver:Ne(To)}),{pdeLoading:i,plantillaDetalleExtra:r}=wo();return e.jsxs(Ke,{children:[e.jsx("div",{className:"breadcrumb",children:e.jsx(_e,{routeSegments:[{name:"Facturacion ICE",path:"/ventas/registro"},{name:"Registrar ICE"}]})}),e.jsx("form",{noValidate:!0,children:e.jsxs(C,{container:!0,spacing:2,children:[e.jsx(C,{item:!0,lg:12,md:12,xs:12,children:e.jsx(Fo,{form:t})}),e.jsx(C,{item:!0,lg:12,md:12,xs:12,children:e.jsx(Qo,{form:t,periodoDate:""})}),e.jsx(C,{item:!0,lg:12,md:12,xs:12,children:i?e.jsx(ne,{mensaje:"Cargando..."}):e.jsx(Xo,{form:t,detalleExtra:r})}),e.jsx(C,{item:!0,lg:7,md:12,xs:12,children:e.jsx("div",{style:{padding:"20px 0"},children:e.jsxs(se,{title:"Cliente / Método de pago",children:[e.jsx(zo,{form:t,user:o}),e.jsx(re,{}),e.jsx(ot,{form:t})]})})}),e.jsx(C,{item:!0,lg:5,md:6,xs:12,children:e.jsx("div",{style:{padding:"20px 0"},children:e.jsx(lt,{form:t})})})]})}),e.jsx(fo,{py:"12px"})]})};export{Da as default};
