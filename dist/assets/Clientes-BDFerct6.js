import{r as c,j as e}from"./react-C-yax-zd.js";import{S as Q}from"./SimpleContainer-tFVAehGQ.js";import{B as Z}from"./Breadcrumb-BAVYU1BR.js";import{e as J}from"./@tanstack-CH50zjZF.js";import{M as X}from"./material-react-table-B3_JpHKP.js";import{S as Y}from"./StackMenuActionTable-DYZWaJ7j.js";import{b as w,P as A}from"./index-CmjSjgDW.js";import{A as y,M as z,g as m,s as E,a as D,b as ee}from"./index-eXxrUaeE.js";import{a as k,n as I,b as oe}from"./notification-CZdNX9HX.js";import{b as te,c as ie,d as ae,e as ne,g as re,h as se,i as le,j as ce,f as me,C as de,a as pe}from"./ClienteRegistroDialog-D7IqBZrH.js";import{g as v,G as R}from"./graphql-request-rGYrdPjm.js";import{A as ue}from"./AuditIconButton-Sfu7xKjf.js";import{S as ge,a as he}from"./SimpleMenu-bKr1ysvp.js";import{o as $}from"./@hookform-CI7dTiWF.js";import{u as U}from"./react-hook-form-Cc6cmx_T.js";import{a5 as N,a6 as P,a7 as B,a8 as L,g as C,ae as fe,bj as Ce,bo as xe,k as Se,bs as je,B as De,b8 as be,$ as we,aJ as M,aN as Ae}from"./@mui-Cg5JgIJd.js";import{M as ye}from"./muiTableAdvancedOptionsProps-8HbDsjdr.js";import"./@babel-BWOPM2cf.js";import"./react-router-dom-BXf9Krd-.js";import"./react-dom-BMaWjgIA.js";import"./scheduler-CzFDRTuY.js";import"./react-router-m6rhPc7O.js";import"./@remix-run-DEp2-txB.js";import"./highlight-words-DHKmS53s.js";import"./rc-input-number-DHeBSjOn.js";import"./@rc-component-BLzWySNC.js";import"./classnames-F3cnkUDL.js";import"./rc-input-CDxr26_S.js";import"./rc-util-RNQGGLoE.js";import"./react-is-DcfIKM1A.js";import"./react-toastify-Bq65RiZx.js";import"./clsx-B-dksMZM.js";import"./react-datepicker-D7PCQ8zk.js";import"./date-fns-9p2ure4y.js";import"./react-onclickoutside-vgQ6ifgl.js";import"./@floating-ui-BqRERJ-b.js";import"./perfect-scrollbar-BfaLzep3.js";import"./lodash-Dwhj6_6J.js";import"./jwt-decode-VWaDGczM.js";import"./sweetalert2-CxYvYGPM.js";import"./nanoid-CeQjyfxW.js";import"./@emotion-D9k8Qpvi.js";import"./hoist-non-react-statics-DQogQWOa.js";import"./stylis-NkKAe6Bn.js";import"./react-transition-group-C1IEqfrK.js";import"./dom-helpers-D0mFdbeO.js";import"./prop-types-tGFuYKac.js";import"./@popperjs-BQBsAJpH.js";import"./graphql-BS3ZITc9.js";import"./cross-fetch-Ml2K_YIJ.js";import"./FormTextField-DeIeSGMe.js";import"./react-select-u2NJ9wTD.js";import"./use-isomorphic-layout-effect-CqeZr6kb.js";import"./memoize-one-BdPwpGay.js";import"./AlertError-Drenn0X8.js";import"./AlertLoading-CGYU8vZk.js";import"./Typography-SNySdv6H.js";import"./MyInputLabel-BamhhSIO.js";import"./ReactSelect-CWkwVJtW.js";import"./yup-DbVgGITq.js";import"./property-expr-DEi1ZLzV.js";import"./tiny-case-BJ7jYKNY.js";import"./toposort-CW3e93qZ.js";import"./yup-locales-C3yB5wWh.js";import"./materialReactTableUtils-RKRDldrD.js";const ze=v`
  mutation CLIENTE_ELIMINAR($codigosCliente: [String]!) {
    clientesEliminar(codigosCliente: $codigosCliente)
  }
`,Ee=async o=>{try{const t=new R("https://sandbox.isipass.net/api"),i=localStorage.getItem(y);return t.setHeader("authorization",`Bearer ${i}`),(await t.request(ze,{codigosCliente:o})).clientesEliminar}catch(t){throw new z(t)}},Ie=v`
  mutation CLIENTE_99001_ACTUALIZAR($id: ID!, $input: Cliente99001UpdateInput!) {
    cliente99001Update(id: $id, input: $input) {
      _id
      razonSocial
      tipoDocumentoIdentidad {
        codigoClasificador
        descripcion
      }
      codigoCliente
      numeroDocumento
      complemento
      nombres
      apellidos
      email
      codigoExcepcion
    }
  }
`,ve=async(o,t)=>{try{const i=new R("https://sandbox.isipass.net/api"),n=localStorage.getItem(y);return i.setHeader("authorization",`Bearer ${n}`),(await i.request(Ie,{id:o,input:t})).cliente99001Update}catch(i){throw new z(i)}},Re=o=>({nombres:m(o.nombres,""),apellidos:m(o.apellidos,""),email:o.email,razonSocial:o.razonSocial}),Te=(o,t)=>({codigoCliente:o.codigoCliente,razonSocial:o.razonSocial,email:o.email,nombres:m(o.nombres,""),apellidos:m(o.apellidos,""),action:t}),Fe=o=>{const{onClose:t,keepMounted:i,open:n,cliente:r,...h}=o,l=U({defaultValues:{...te,action:w.UPDATE},resolver:$(ie)}),d=async p=>{const u=await ne();if(u.length>0)k(u.join("<br>"));else{const g=Re(p);await E({preConfirm:async()=>{const a=await ve(r._id,g).catch(S=>({error:S}));return a.error?(D(a.error),!1):a}}).then(a=>{a.isConfirmed&&(I(),t(a.value)),a.isDenied&&D(a.value)})}},x=(p,u)=>console.log(p,u);return c.useEffect(()=>{n&&r&&n&&l.reset(Te(r,w.UPDATE))},[n]),e.jsx(e.Fragment,{children:e.jsxs(N,{sx:{"& .MuiDialog-paper":{width:"90%",maxHeight:600}},maxWidth:"sm",keepMounted:i,open:n,...h,children:[e.jsxs(P,{children:["Actualizar cliente 99001 ",r.razonSocial]}),e.jsx(B,{dividers:!0,children:e.jsx(ae,{form:l})}),e.jsxs(L,{children:[e.jsx(C,{autoFocus:!0,color:"error",variant:"contained",size:"small",onClick:()=>{t()},children:"Cancelar"}),e.jsx(C,{onClick:l.handleSubmit(d,x),style:{marginRight:15},size:"small",variant:"contained",children:"Guardar Cambios"})]})]})})},Me=v`
  mutation CLIENTE_ACTUALIZACION($id: ID!, $input: ClienteUpdateInput!) {
    clienteUpdate(id: $id, input: $input) {
      _id
      razonSocial
      tipoDocumentoIdentidad {
        codigoClasificador
        descripcion
      }
      codigoCliente
      numeroDocumento
      complemento
      nombres
      apellidos
      email
      codigoExcepcion
    }
  }
`,ke=async(o,t)=>{try{const i=new R("https://sandbox.isipass.net/api"),n=localStorage.getItem(y);return i.setHeader("authorization",`Bearer ${n}`),(await i.request(Me,{id:o,input:t})).clienteUpdate}catch(i){throw new z(i)}},$e=o=>({apellidos:m(o.apellidos,""),complemento:m(o.complemento,""),email:m(o.email,""),nombres:m(o.nombres,""),numeroDocumento:o.numeroDocumento,razonSocial:o.razonSocial,telefono:m(o.telefono,"")}),Ue=(o,t)=>({sinTipoDocumento:o.tipoDocumentoIdentidad,razonSocial:o.razonSocial,numeroDocumento:o.numeroDocumento,complemento:m(o.complemento,""),email:o.email,nombres:m(o.nombres,""),apellidos:m(o.apellidos,""),telefono:m(o.telefono,""),action:t}),Ne=o=>{const{onClose:t,keepMounted:i,open:n,cliente:r,...h}=o,l=U({defaultValues:{...re,action:w.UPDATE},resolver:$(se)}),d=async p=>{const u=await ce();if(u.length>0)k(u.join("<br>"));else{const g=$e(p);await E({preConfirm:async()=>{const a=await ke(r._id,g).catch(S=>({error:S}));return a.error?(D(a.error),!1):a}}).then(a=>{a.isConfirmed&&(I(),t(a.value)),a.isDenied&&D(a.value)})}},x=(p,u)=>console.log(p,u);return c.useEffect(()=>{r&&n&&l.reset(Ue(r,w.UPDATE))},[n]),e.jsx(e.Fragment,{children:e.jsxs(N,{sx:{"& .MuiDialog-paper":{width:"100%",maxHeight:800}},maxWidth:"sm",keepMounted:i,open:n,...h,children:[e.jsxs(P,{children:["Actualizar cliente ",r.razonSocial]}),e.jsx(B,{dividers:!0,children:e.jsx(le,{form:l})}),e.jsxs(L,{children:[e.jsx(C,{autoFocus:!0,color:"error",variant:"contained",size:"small",onClick:()=>{t()},children:"Cancelar"}),e.jsx(C,{onClick:l.handleSubmit(d,x),style:{marginRight:15},size:"small",variant:"contained",disabled:!l.formState.isValid,children:"Guardar Cambios"})]})]})})},Pe=o=>{const{row:t,refetch:i}=o,[n,r]=c.useState(!1),[h,l]=c.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",flexWrap:"nowrap",gap:"0.5rem",width:100},children:[e.jsx(ge,{menuButton:e.jsx(e.Fragment,{children:e.jsx(fe,{"aria-label":"menuGestionRoles",children:e.jsx(Ce,{})})}),children:e.jsxs(he,{onClick:()=>{t.numeroDocumento==="99001"?l(!0):r(!0)},children:[e.jsx(xe,{})," Modificar"]})}),e.jsx(ue,{row:t})]}),e.jsx(Ne,{id:"clienteActualizarDialgo",keepMounted:!1,open:n,cliente:t,onClose:d=>{r(!1),d&&i().then()}}),e.jsx(Fe,{id:"cliente99001ActualizarDialgo",keepMounted:!1,open:h,cliente:t,onClose:d=>{l(!1),d&&i().then()}})]})},Be=[{accessorKey:"codigoCliente",header:"Código Cliente"},{accessorKey:"razonSocial",header:"Razon Social"},{accessorFn:o=>`${o.numeroDocumento}${o.complemento?`-${o.complemento}`:""}`,id:"numeroDocumento",header:"Nro. Documento"},{id:"email",header:"Correo",accessorKey:"email"},{accessorKey:"tipoDocumentoIdentidad.descripcion",id:"tipoDocumentoIdentidad.descripcion",header:"Tipo Documento"},{accessorFn:o=>e.jsx(we,{size:"small",label:o.state,color:"success"}),id:"state",header:"Estado"}],Le=o=>{const[t,i]=c.useState(!1),[n,r]=c.useState(!1),[h,l]=c.useState(0),[d,x]=c.useState([]),[p,u]=c.useState([]),[g,a]=c.useState({pageIndex:A.page,pageSize:A.limit}),[S,T]=c.useState({}),[_e,F]=c.useState(!1),_=async()=>{F(!0);try{await j()}catch(s){console.error("Error al recargar los datos:",s)}F(!1)},{data:q,isError:G,isLoading:V,isFetching:O,refetch:j}=J({queryKey:["client",d,g.pageIndex,g.pageSize,p],queryFn:async()=>{const s=ee(d),b={...A,page:g.pageIndex+1,limit:g.pageSize,reverse:p.length<=0,query:s},{pageInfo:f,docs:W}=await me(b);return l(f.totalDocs),W},refetchOnWindowFocus:!1,refetchInterval:!1}),H=c.useMemo(()=>Be,[]),K=async s=>{const b=s.map(f=>f.original.codigoCliente);if(b.length===0){oe("No se ha seleccionado ningun registro, vuelva a intentar");return}await E({text:"Confirma que desea eliminar los registros seleccionados y sus respectivas variantes, esta operación no se podra revertir",preConfirm:()=>Ee(b).catch(f=>(D(f),!1))}).then(f=>{f.isConfirmed&&(I(),T({}),j().then())})};return e.jsxs(e.Fragment,{children:[e.jsxs(Se,{direction:{xs:"column",sm:"row"},spacing:1,justifyContent:"right",sx:{marginBottom:3},children:[e.jsxs(C,{size:"small",variant:"contained",onClick:()=>i(!0),startIcon:e.jsx(je,{}),color:"primary",children:[" ","Nuevo Cliente"]}),e.jsx(C,{size:"small",variant:"contained",onClick:()=>r(!0),color:"primary",children:"Nuevo Cliente (99001)"})]}),e.jsx(X,{...ye,columns:H,data:q??[],initialState:{showColumnFilters:!1},manualFiltering:!0,manualPagination:!0,manualSorting:!0,onColumnFiltersChange:x,onPaginationChange:a,onSortingChange:u,enableDensityToggle:!1,enableGlobalFilter:!1,rowCount:h,enableRowNumbers:!0,state:{isLoading:V,columnFilters:d,pagination:g,showAlertBanner:G,showProgressBars:O,sorting:p,density:"compact",rowSelection:S},enableRowActions:!0,positionActionsColumn:"first",renderRowActions:({row:s})=>e.jsx(Pe,{row:s.original,refetch:j}),onRowSelectionChange:T,enableRowSelection:!0,muiSelectCheckboxProps:({row:s})=>({disabled:["99003","99002"].includes(s.getValue("numeroDocumento"))}),renderTopToolbarCustomActions:({table:s})=>e.jsxs(De,{sx:{display:"flex",gap:"1rem",p:"0.5rem",flexWrap:"wrap"},children:[e.jsx(Y,{refetch:_,sx:{flexGrow:1}}),e.jsx(C,{color:"error",onClick:()=>K(s.getSelectedRowModel().flatRows),startIcon:e.jsx(be,{}),variant:"contained",size:"small",disabled:s.getSelectedRowModel().flatRows.length===0,sx:{height:"28px",top:"0.5rem"},children:"Eliminar"})]})}),e.jsx(de,{id:"clienteRegistroDialgo",keepMounted:!1,open:t,onClose:s=>{s&&j().then(),i(!1)}}),e.jsx(pe,{id:"cliente99001Registro",keepMounted:!1,open:n,onClose:s=>{r(!1),s&&j().then()}})]})},et=o=>e.jsxs(Q,{children:[e.jsx("div",{className:"breadcrumb",children:e.jsx(Z,{routeSegments:[{name:"Gestion de clientes",path:"/clientes/gestion"}]})}),e.jsx("form",{noValidate:!0,children:e.jsx(M,{container:!0,spacing:2,children:e.jsx(M,{item:!0,lg:12,md:12,xs:12,children:e.jsx(Le,{})})})}),e.jsx(Ae,{py:"12px"})]});export{et as default};
