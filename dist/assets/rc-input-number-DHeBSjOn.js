import{e as C,_ as j,l as Ve,m as L,j as Ge}from"./@babel-BWOPM2cf.js";import{n as Me,t as Ee,g as h,a as ye,v as Je,b as ue}from"./@rc-component-BLzWySNC.js";import{c as le}from"./classnames-F3cnkUDL.js";import{B as Qe,t as Xe}from"./rc-input-CDxr26_S.js";import{r}from"./react-C-yax-zd.js";import{w as Ze,a as Y,u as ea,c as _e,b as oe}from"./rc-util-RNQGGLoE.js";function aa(e,i){var u=r.useRef(null);function x(){try{var m=e.selectionStart,b=e.selectionEnd,c=e.value,N=c.substring(0,m),g=c.substring(b);u.current={start:m,end:b,value:c,beforeTxt:N,afterTxt:g}}catch{}}function d(){if(e&&u.current&&i)try{var m=e.value,b=u.current,c=b.beforeTxt,N=b.afterTxt,g=b.start,s=m.length;if(m.endsWith(N))s=m.length-u.current.afterTxt.length;else if(m.startsWith(c))s=c.length;else{var p=c[g-1],v=m.indexOf(p,g-1);v!==-1&&(s=v+1)}e.setSelectionRange(s,s)}catch(f){Ze(!1,"Something warning of cursor restore. Please fire issue about this: ".concat(f.message))}}return[x,d]}var na=200,ra=600;function ta(e){var i=e.prefixCls,u=e.upNode,x=e.downNode,d=e.upDisabled,m=e.downDisabled,b=e.onStep,c=r.useRef(),N=r.useRef([]),g=r.useRef();g.current=b;var s=function(){clearTimeout(c.current)},p=function(y,O){y.preventDefault(),s(),g.current(O);function k(){g.current(O),c.current=setTimeout(k,na)}c.current=setTimeout(k,ra)};r.useEffect(function(){return function(){s(),N.current.forEach(function(w){return Y.cancel(w)})}},[]);var v=ea();if(v)return null;var f="".concat(i,"-handler"),E=le(f,"".concat(f,"-up"),C({},"".concat(f,"-up-disabled"),d)),P=le(f,"".concat(f,"-down"),C({},"".concat(f,"-down-disabled"),m)),R=function(){return N.current.push(Y(s))},W={unselectable:"on",role:"button",onMouseUp:R,onMouseLeave:R};return r.createElement("div",{className:"".concat(f,"-wrap")},r.createElement("span",j({},W,{onMouseDown:function(y){p(y,!0)},"aria-label":"Increase Value","aria-disabled":d,className:E}),u||r.createElement("span",{unselectable:"on",className:"".concat(i,"-handler-up-inner")})),r.createElement("span",j({},W,{onMouseDown:function(y){p(y,!1)},"aria-label":"Decrease Value","aria-disabled":m,className:P}),x||r.createElement("span",{unselectable:"on",className:"".concat(i,"-handler-down-inner")})))}function Ce(e){var i=typeof e=="number"?Me(e):Ee(e).fullStr,u=i.includes(".");return u?Ee(i.replace(/(\d)\.(\d)/g,"$1$2.")).fullStr:e+"0"}const ua=function(){var e=r.useRef(0),i=function(){Y.cancel(e.current)};return r.useEffect(function(){return i},[]),function(u){i(),e.current=Y(function(){u()})}};var oa=["prefixCls","className","style","min","max","step","defaultValue","value","disabled","readOnly","upHandler","downHandler","keyboard","changeOnWheel","controls","classNames","stringMode","parser","formatter","precision","decimalSeparator","onChange","onInput","onPressEnter","onStep","changeOnBlur"],la=["disabled","style","prefixCls","value","prefix","suffix","addonBefore","addonAfter","className","classNames"],Re=function(i,u){return i||u.isEmpty()?u.toString():u.toNumber()},De=function(i){var u=h(i);return u.isInvalidate()?null:u},sa=r.forwardRef(function(e,i){var u,x=e.prefixCls,d=x===void 0?"rc-input-number":x,m=e.className,b=e.style,c=e.min,N=e.max,g=e.step,s=g===void 0?1:g,p=e.defaultValue,v=e.value,f=e.disabled,E=e.readOnly,P=e.upHandler,R=e.downHandler,W=e.keyboard,w=e.changeOnWheel,y=w===void 0?!1:w,O=e.controls,k=O===void 0?!0:O;e.classNames;var se=e.stringMode,H=e.parser,D=e.formatter,V=e.precision,M=e.decimalSeparator,z=e.onChange,G=e.onInput,J=e.onPressEnter,Q=e.onStep,ie=e.changeOnBlur,Be=ie===void 0?!0:ie,Oe=Ve(e,oa),ce="".concat(d,"-input"),U=r.useRef(null),Ue=r.useState(!1),fe=L(Ue,2),X=fe[0],de=fe[1],I=r.useRef(!1),$=r.useRef(!1),T=r.useRef(!1),$e=r.useState(function(){return h(v??p)}),ve=L($e,2),l=ve[0],me=ve[1];function Ae(n){v===void 0&&me(n)}var Z=r.useCallback(function(n,a){if(!a)return V>=0?V:Math.max(ye(n),ye(s))},[V,s]),ee=r.useCallback(function(n){var a=String(n);if(H)return H(a);var o=a;return M&&(o=o.replace(M,".")),o.replace(/[^\w.-]+/g,"")},[H,M]),ae=r.useRef(""),pe=r.useCallback(function(n,a){if(D)return D(n,{userTyping:a,input:String(ae.current)});var o=typeof n=="number"?Me(n):n;if(!a){var t=Z(o,a);if(Je(o)&&(M||t>=0)){var S=M||".";o=ue(o,S,t)}}return o},[D,Z,M]),Fe=r.useState(function(){var n=p??v;return l.isInvalidate()&&["string","number"].includes(Ge(n))?Number.isNaN(n)?"":n:pe(l.toString(),!1)}),ge=L(Fe,2),A=ge[0],be=ge[1];ae.current=A;function F(n,a){be(pe(n.isInvalidate()?n.toString(!1):n.toString(!a),a))}var _=r.useMemo(function(){return De(N)},[N,V]),B=r.useMemo(function(){return De(c)},[c,V]),Ne=r.useMemo(function(){return!_||!l||l.isInvalidate()?!1:_.lessEquals(l)},[_,l]),Se=r.useMemo(function(){return!B||!l||l.isInvalidate()?!1:l.lessEquals(B)},[B,l]),Ke=aa(U.current,X),he=L(Ke,2),Pe=he[0],We=he[1],we=function(a){return _&&!a.lessEquals(_)?_:B&&!B.lessEquals(a)?B:null},ne=function(a){return!we(a)},q=function(a,o){var t=a,S=ne(t)||t.isEmpty();if(!t.isEmpty()&&!o&&(t=we(t)||t,S=!0),!E&&!f&&S){var K=t.toString(),te=Z(K,o);return te>=0&&(t=h(ue(K,".",te)),ne(t)||(t=h(ue(K,".",te,!0)))),t.equals(l)||(Ae(t),z==null||z(t.isEmpty()?null:Re(se,t)),v===void 0&&F(t,o)),t}return l},ke=ua(),xe=function n(a){if(Pe(),ae.current=a,be(a),!$.current){var o=ee(a),t=h(o);t.isNaN()||q(t,!0)}G==null||G(a),ke(function(){var S=a;H||(S=a.replace(/ã€‚/g,".")),S!==a&&n(S)})},He=function(){$.current=!0},Te=function(){$.current=!1,xe(U.current.value)},qe=function(a){xe(a.target.value)},re=function(a){var o;if(!(a&&Ne||!a&&Se)){I.current=!1;var t=h(T.current?Ce(s):s);a||(t=t.negate());var S=(l||h(0)).add(t.toString()),K=q(S,!1);Q==null||Q(Re(se,K),{offset:T.current?Ce(s):s,type:a?"up":"down"}),(o=U.current)===null||o===void 0||o.focus()}},Ie=function(a){var o=h(ee(A)),t=o;o.isNaN()?t=q(l,a):t=q(o,a),v!==void 0?F(l,!1):t.isNaN()||F(t,!1)},Le=function(){I.current=!0},je=function(a){var o=a.key,t=a.shiftKey;I.current=!0,T.current=t,o==="Enter"&&($.current||(I.current=!1),Ie(!1),J==null||J(a)),W!==!1&&!$.current&&["Up","ArrowUp","Down","ArrowDown"].includes(o)&&(re(o==="Up"||o==="ArrowUp"),a.preventDefault())},Ye=function(){I.current=!1,T.current=!1};r.useEffect(function(){if(y&&X){var n=function(t){re(t.deltaY<0),t.preventDefault()},a=U.current;if(a)return a.addEventListener("wheel",n,{passive:!1}),function(){return a.removeEventListener("wheel",n)}}});var ze=function(){Be&&Ie(!1),de(!1),I.current=!1};return oe(function(){l.isInvalidate()||F(l,!1)},[V,D]),oe(function(){var n=h(v);me(n);var a=h(ee(A));(!n.equals(a)||!I.current||D)&&F(n,I.current)},[v]),oe(function(){D&&We()},[A]),r.createElement("div",{className:le(d,m,(u={},C(u,"".concat(d,"-focused"),X),C(u,"".concat(d,"-disabled"),f),C(u,"".concat(d,"-readonly"),E),C(u,"".concat(d,"-not-a-number"),l.isNaN()),C(u,"".concat(d,"-out-of-range"),!l.isInvalidate()&&!ne(l)),u)),style:b,onFocus:function(){de(!0)},onBlur:ze,onKeyDown:je,onKeyUp:Ye,onCompositionStart:He,onCompositionEnd:Te,onBeforeInput:Le},k&&r.createElement(ta,{prefixCls:d,upNode:P,downNode:R,upDisabled:Ne,downDisabled:Se,onStep:re}),r.createElement("div",{className:"".concat(ce,"-wrap")},r.createElement("input",j({autoComplete:"off",role:"spinbutton","aria-valuemin":c,"aria-valuemax":N,"aria-valuenow":l.isInvalidate()?null:l.toString(),step:s},Oe,{ref:_e(U,i),className:ce,value:A,onChange:qe,disabled:f,readOnly:E}))))}),ia=r.forwardRef(function(e,i){var u=e.disabled,x=e.style,d=e.prefixCls,m=e.value,b=e.prefix,c=e.suffix,N=e.addonBefore,g=e.addonAfter,s=e.className,p=e.classNames,v=Ve(e,la),f=r.useRef(null),E=function(R){f.current&&Xe(f.current,R)};return r.createElement(Qe,{className:s,triggerFocus:E,prefixCls:d,value:m,disabled:u,style:x,prefix:b,suffix:c,addonAfter:g,addonBefore:N,classNames:p,components:{affixWrapper:"div",groupWrapper:"div",wrapper:"div",groupAddon:"div"}},r.createElement(sa,j({prefixCls:d,disabled:u,ref:_e(f,i),className:p==null?void 0:p.input},v)))});ia.displayName="InputNumber";export{ia as I};
