import{r as f,j as e}from"./react-C-yax-zd.js";import{S as W}from"./react-select-u2NJ9wTD.js";import{A as b}from"./AlertLoading-CGYU8vZk.js";import{S as L}from"./SimpleContainer-tFVAehGQ.js";import{n as d}from"./NumberInput-ChEcYOmf.js";import{r as q}from"./ReactSelect-CWkwVJtW.js";import{S as g}from"./SimpleCard-Cf1MrNuW.js";import{a as F}from"./Typography-SNySdv6H.js";import{A as _,M as G,g as m,u as H,a as X}from"./index-eXxrUaeE.js";import{g as Y,G as Q}from"./graphql-request-rGYrdPjm.js";import{y as J}from"./lodash-Dwhj6_6J.js";import{a as T}from"./index-CmjSjgDW.js";import{M as $,a as I}from"./material-react-table-B3_JpHKP.js";import{M as E,a as N}from"./materialReactTableUtils-RKRDldrD.js";import{aN as K,aU as S,aV as Z,aW as ee,aJ as c,B as M,aK as ae,aX as V}from"./@mui-Cg5JgIJd.js";import{f as s,P,a5 as A,C as te,D as oe,Q as B,a6 as v,r as C}from"./date-fns-9p2ure4y.js";import{R as re,L as se,C as ie,X as ne,Y as le,T as de,a as ce,b as w}from"./recharts-HvPW8aQS.js";import"./@babel-BWOPM2cf.js";import"./react-dom-BMaWjgIA.js";import"./scheduler-CzFDRTuY.js";import"./@emotion-D9k8Qpvi.js";import"./hoist-non-react-statics-DQogQWOa.js";import"./stylis-NkKAe6Bn.js";import"./@floating-ui-BqRERJ-b.js";import"./use-isomorphic-layout-effect-CqeZr6kb.js";import"./memoize-one-BdPwpGay.js";import"./clsx-B-dksMZM.js";import"./rc-input-number-DHeBSjOn.js";import"./@rc-component-BLzWySNC.js";import"./classnames-F3cnkUDL.js";import"./rc-input-CDxr26_S.js";import"./rc-util-RNQGGLoE.js";import"./react-is-DcfIKM1A.js";import"./react-toastify-Bq65RiZx.js";import"./react-datepicker-D7PCQ8zk.js";import"./react-onclickoutside-vgQ6ifgl.js";import"./perfect-scrollbar-BfaLzep3.js";import"./@tanstack-CH50zjZF.js";import"./react-router-dom-BXf9Krd-.js";import"./react-router-m6rhPc7O.js";import"./@remix-run-DEp2-txB.js";import"./jwt-decode-VWaDGczM.js";import"./sweetalert2-CxYvYGPM.js";import"./nanoid-CeQjyfxW.js";import"./react-transition-group-C1IEqfrK.js";import"./dom-helpers-D0mFdbeO.js";import"./prop-types-tGFuYKac.js";import"./@popperjs-BQBsAJpH.js";import"./graphql-BS3ZITc9.js";import"./cross-fetch-Ml2K_YIJ.js";import"./highlight-words-DHKmS53s.js";import"./react-smooth-BNPx_GIa.js";import"./fast-equals-C7I1S-bJ.js";import"./d3-shape-DjFPhhqo.js";import"./d3-path-CimkQT29.js";import"./victory-vendor-CxH3O8XQ.js";import"./d3-scale-BiDuKWOz.js";import"./internmap-BkD7Hj8s.js";import"./d3-array-DZCLYp0I.js";import"./d3-time-format-BNWzTjzF.js";import"./d3-time-Dy9pGca3.js";import"./d3-interpolate-CvRPKVI0.js";import"./d3-color-9lF95FHy.js";import"./d3-format-CzD4bSOQ.js";import"./recharts-scale-DiOBu8nk.js";import"./decimal.js-light-B5-9uEc-.js";import"./eventemitter3-XOpRPA-Z.js";const me=Y`
  query VENTAS_X_USUARIO(
    $fechaInicial: DateDMY!
    $fechaFinal: DateDMY!
    $entidad: [EntidadParamsInput]
  ) {
    iceReporteVentasUsuario(
      fechaInicial: $fechaInicial
      fechaFinal: $fechaFinal
      entidad: $entidad
    ) {
      sucursal
      puntoVenta
      usuario
      numeroFacturas
      montoTotal
      state
    }
  }
`,pe=async(t,i,o)=>{try{const a=new Q("https://sandbox.isipass.net/api"),h=localStorage.getItem(_);return a.setHeader("authorization",`Bearer ${h}`),(await a.request(me,{fechaInicial:t,fechaFinal:i,entidad:o})).iceReporteVentasUsuario||[]}catch(a){throw new G(a)}},ue=t=>{try{const i=[],o=J.uniqBy(t,"usuario");if(o.length===0)return null;let a=0,h=0;for(const x of o){let n=0,y=0,p=0,u=0;for(const l of t)l.usuario===x.usuario&&(l.state===T.validada&&(n+=l.numeroFacturas,p+=l.montoTotal),[T.anulado,T.eliminado].includes(l.state)&&(y+=l.numeroFacturas,u+=l.montoTotal));i.push({usuario:x.usuario,nroValidadas:n,nroAnuladas:y,montoValidadas:p,montoAnuladas:u,nroParcialFacturas:n+y,montoParcialFacturas:p-u}),a+=n+y,h+=p-u}return{nroTotalFacturas:a,montoTotalFacturas:h,detalle:i}}catch{throw new Error("Error en generacion del reporte")}},he=t=>{const{data:i}=t,o=f.useMemo(()=>[{accessorKey:"mesTexto",header:"Mes",size:100},{accessorKey:"nroPendientes",header:"Nro. Pendientes",muiTableBodyCellProps:{align:"right"},Cell:({cell:a})=>d(m(a.getValue(),0),{}),size:100},{accessorKey:"nroValidadas",header:"Nro. Validadas",muiTableBodyCellProps:{align:"right"},Cell:({cell:a})=>d(m(a.getValue(),0),{}),size:110},{accessorKey:"nroAnuladas",header:"Nro. Anulados",muiTableBodyCellProps:{align:"right"},Cell:({cell:a})=>d(m(a.getValue(),0),{}),size:110},{accessorKey:"nroParcialFacturas",header:"SUB-TOTAL",muiTableBodyCellProps:{align:"right",sx:a=>({color:a.palette.primary.light,fontWeight:500})},Cell:({cell:a})=>d(m(a.getValue(),0),{}),size:120}],[]);return e.jsx(e.Fragment,{children:e.jsx(K,{children:e.jsx($,{columns:o,data:i.detalle||[],initialState:{density:"compact"},localization:I,displayColumnDefOptions:E,muiTableProps:N,enableColumnActions:!1,enableColumnFilters:!1,enablePagination:!1,enableSorting:!1,enableBottomToolbar:!1,enableTopToolbar:!1,muiTableBodyRowProps:{hover:!1}})})})},ye=t=>{const{data:i}=t,o=f.useMemo(()=>[{accessorKey:"usuario",header:"Nombre de Usuario"},{accessorKey:"montoValidadas",header:"Monto Total Validadas",muiTableBodyCellProps:{align:"right"},Cell:({cell:a})=>d(m(a.getValue(),0),{}),size:150},{accessorKey:"montoAnuladas",header:"Monto Total Anulados",muiTableBodyCellProps:{align:"right"},Cell:({cell:a})=>d(m(a.getValue(),0),{}),size:150},{accessorKey:"montoParcialFacturas",header:"SUB-TOTAL",muiTableBodyCellProps:{align:"right"},Cell:({cell:a})=>d(m(a.getValue(),0),{})}],[]);return e.jsx(e.Fragment,{children:e.jsx(K,{children:e.jsx($,{columns:o,data:i.detalle||[],initialState:{density:"compact"},localization:I,displayColumnDefOptions:E,muiTableProps:N,enableColumnActions:!1,enableColumnFilters:!1,enablePagination:!1,enableSorting:!1,enableBottomToolbar:!1,enableTopToolbar:!1,muiTableBodyRowProps:{hover:!1}})})})},O=S(Z)(({theme:t})=>({display:"flex",flexWrap:"wrap",alignItems:"center",justifyContent:"space-between",padding:"24px !important",background:t.palette.background.paper,[t.breakpoints.down("sm")]:{padding:"16px !important"}})),k=S("div")(({theme:t})=>({display:"flex",flexWrap:"wrap",alignItems:"center","& small":{color:t.palette.text.secondary},"& .icon":{opacity:.6,fontSize:"44px",color:t.palette.primary.main}})),R=S("h6")(({theme:t})=>({margin:0,marginTop:"4px",fontWeight:"500",fontSize:"20px",color:t.palette.primary.main})),Pa=()=>{const t=[{fechaInicial:s(P(new Date,{weekStartsOn:1}),"dd/MM/yyyy"),fechaFinal:s(A(new Date,{weekStartsOn:1}),"dd/MM/yyyy"),value:`Semana del ${s(P(new Date,{weekStartsOn:1}),"dd/MM/yyyy")} Al ${s(A(new Date,{weekStartsOn:1}),"dd/MM/yyyy")}`},{fechaInicial:s(te(new Date),"dd/MM/yyyy"),fechaFinal:s(oe(new Date),"dd/MM/yyyy"),value:`Hoy ${s(new Date,"dd/MM/yyyy")}`},{fechaInicial:s(B(new Date),"dd/MM/yyyy"),fechaFinal:s(v(new Date),"dd/MM/yyyy"),value:s(new Date,"MM/yyyy")},{fechaInicial:s(B(C(new Date,1)),"dd/MM/yyyy"),fechaFinal:s(v(C(new Date,1)),"dd/MM/yyyy"),value:s(C(new Date,1),"MM/yyyy")}],{user:i}=H(),[o,a]=f.useState(t[0]),h=[{codigoSucursal:i.sucursal.codigo,codigoPuntoVenta:i.puntoVenta.codigo}],x={montoTotalFacturas:0,nroTotalFacturas:0,detalle:[]},[n,y]=f.useState(x),[p,u]=f.useState(!1),l=async(r,U,z)=>{u(!0);try{const j=await pe(r,U,z);if(j.length>0){const D=ue(j);D&&y(D)}else y(x);u(!1)}catch(j){u(!1),X(j)}};return f.useEffect(()=>{const r=t[0];l(r.fechaInicial,r.fechaFinal,h).then()},[]),e.jsx(ee,{maxWidth:"xl",children:e.jsx(f.Fragment,{children:e.jsx(L,{className:"analytics",children:e.jsxs(c,{container:!0,spacing:3,children:[e.jsx(c,{item:!0,lg:12,sm:12,children:e.jsx(g,{title:"Seleccione el periodo",children:e.jsx(M,{className:"asideSidebarFixed",children:e.jsx(ae,{fullWidth:!0,children:e.jsx(W,{styles:q(!1),name:"periodo",placeholder:"Seleccione el periodo de busqueda",menuPosition:"fixed",defaultValue:o,onChange:async r=>{await l(r.fechaInicial,r.fechaFinal,h),a(r)},isSearchable:!1,options:t,getOptionValue:r=>r.value,getOptionLabel:r=>`${r.value}`})})})})}),e.jsx(c,{item:!0,lg:9,md:10,xs:12,children:e.jsx(g,{title:`Reporte de ventas ${o.value}`,children:e.jsx(M,{sx:{width:"100%"},children:p?e.jsx(b,{}):e.jsx(re,{width:"100%",height:280,children:e.jsxs(se,{width:500,height:280,data:n.detalle,children:[e.jsx(ie,{strokeDasharray:"3 3"}),e.jsx(ne,{dataKey:"usuario",padding:{left:50,right:50}}),e.jsx(le,{}),e.jsx(de,{formatter:r=>`${d(r,{})} BOB`}),e.jsx(ce,{}),e.jsx(w,{label:"Monto Anuladas",type:"monotone",strokeWidth:1,dataKey:"montoAnuladas",stroke:"red",activeDot:{r:8}}),e.jsx(w,{type:"monotone",strokeWidth:1,dataKey:"montoValidadas",stroke:"blue",activeDot:{r:8},label:"Monto Validas"}),e.jsx(w,{type:"monotone",strokeWidth:3,dataKey:"montoParcialFacturas",stroke:"green",activeDot:{r:8},label:"Monto Validas"})]})})})})}),e.jsx(c,{item:!0,lg:3,md:2,xs:12,children:e.jsx(g,{title:`RESUMEN ${o.value}`,children:e.jsxs(c,{container:!0,spacing:3,children:[e.jsx(c,{item:!0,lg:12,md:12,xs:12,children:e.jsx(O,{elevation:6,children:e.jsxs(k,{children:[e.jsx(V,{className:"icon",children:"numbers"}),e.jsxs(M,{ml:"12px",children:[e.jsx(F,{children:"Nro. Facturas Periodo"}),e.jsxs(R,{children:[" ",d(m(n.nroTotalFacturas,0),{})]})]})]})})}),e.jsx(c,{item:!0,lg:12,md:12,xs:12,children:e.jsx(O,{elevation:6,children:e.jsxs(k,{children:[e.jsx(V,{className:"icon",children:"attach_money"}),e.jsxs(M,{ml:"12px",children:[e.jsx(F,{children:"Monto Total Periodo"}),e.jsxs(R,{children:[d(m(n.montoTotalFacturas,0),{})," ","BOB"]})]})]})})})]})})}),e.jsx(c,{item:!0,lg:6,md:6,sm:12,xs:12,children:e.jsx(g,{title:`Nro de factura periodo ${o.value}`,children:p?e.jsx(b,{}):e.jsx(he,{data:n})})}),e.jsx(c,{item:!0,lg:6,md:6,sm:12,xs:12,children:e.jsx(g,{title:`Total de ventas periodo ${o.value}`,children:p?e.jsx(b,{}):e.jsx(ye,{data:n})})})]})})})})};export{Pa as default};
