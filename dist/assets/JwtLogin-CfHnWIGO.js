import{r as m,j as e}from"./react-C-yax-zd.js";import{o as J}from"./@hookform-CI7dTiWF.js";import{u as N,C as d}from"./react-hook-form-Cc6cmx_T.js";import{C as R}from"./react-select-u2NJ9wTD.js";import{_ as M}from"./react-turnstile-jo1o8jj1.js";import{c as S,a as h}from"./yup-DbVgGITq.js";import{u as T,i as z}from"./index-eXxrUaeE.js";import{y as O}from"./lodash-Dwhj6_6J.js";import{a7 as U}from"./date-fns-9p2ure4y.js";import{a as $}from"./axios-Cm0UX6qg.js";import{M as H}from"./MyInputLabel-BamhhSIO.js";import{r as W}from"./ReactSelect-CWkwVJtW.js";import{P as w}from"./Typography-SNySdv6H.js";import{aU as p,aN as I,aY as D,aV as G,aJ as c,aK as v,az as C,h as _,aa as X,aZ as K,ah as Y,ae as Z,a_ as Q,a$ as ee,ak as re,b0 as oe}from"./@mui-Cg5JgIJd.js";import{a as se}from"./react-router-m6rhPc7O.js";import"./@babel-BWOPM2cf.js";import"./react-dom-BMaWjgIA.js";import"./scheduler-CzFDRTuY.js";import"./@emotion-D9k8Qpvi.js";import"./hoist-non-react-statics-DQogQWOa.js";import"./stylis-NkKAe6Bn.js";import"./@floating-ui-BqRERJ-b.js";import"./use-isomorphic-layout-effect-CqeZr6kb.js";import"./memoize-one-BdPwpGay.js";import"./property-expr-DEi1ZLzV.js";import"./tiny-case-BJ7jYKNY.js";import"./toposort-CW3e93qZ.js";import"./rc-input-number-DHeBSjOn.js";import"./@rc-component-BLzWySNC.js";import"./classnames-F3cnkUDL.js";import"./rc-input-CDxr26_S.js";import"./rc-util-RNQGGLoE.js";import"./react-is-DcfIKM1A.js";import"./react-toastify-Bq65RiZx.js";import"./clsx-B-dksMZM.js";import"./react-datepicker-D7PCQ8zk.js";import"./react-onclickoutside-vgQ6ifgl.js";import"./perfect-scrollbar-BfaLzep3.js";import"./@tanstack-CH50zjZF.js";import"./react-router-dom-BXf9Krd-.js";import"./@remix-run-DEp2-txB.js";import"./jwt-decode-VWaDGczM.js";import"./sweetalert2-CxYvYGPM.js";import"./graphql-request-rGYrdPjm.js";import"./graphql-BS3ZITc9.js";import"./cross-fetch-Ml2K_YIJ.js";import"./nanoid-CeQjyfxW.js";import"./react-transition-group-C1IEqfrK.js";import"./dom-helpers-D0mFdbeO.js";import"./prop-types-tGFuYKac.js";import"./@popperjs-BQBsAJpH.js";const g="shop",f=()=>{try{return JSON.parse(localStorage.getItem(g)||"[]")}catch{return[]}},k=()=>{try{const t=f();return O.orderBy(t,["date"],["desc"])}catch{return[]}},te=t=>{try{const i=f().filter(l=>l.value!==t);localStorage.setItem(g,JSON.stringify(i))}catch{console.info("No se ha podigo eliminar el recurso")}},ae=t=>{try{const i=f().filter(l=>l.value!==t);i.push({label:t,value:t,date:U(new Date)}),localStorage.setItem(g,JSON.stringify(i))}catch{console.info("No se ha podido eliminar el recurso")}},ie=async t=>{try{const a="https://sandbox.isipass.net/api".slice(0,"https://sandbox.isipass.net/api".lastIndexOf("/"));return(await $.post(`${a}/auth/checkCloudflareHuman`,{token:t})).data.success}catch(a){throw new Error(a.message)}},ne="/assets/images/isibackgroud.jpg",x=p(I)(()=>({display:"flex",alignItems:"center"})),B=p(x)(()=>({justifyContent:"center",padding:"15px 15px 5px 15px"})),le=p(I)(()=>({height:"100%",padding:"20px",position:"relative",background:"rgba(0, 0, 0, 0.01)"})),me=p("img")(()=>({width:"100%",maxHeight:"90px"})),ce=p(B)(()=>({backgroundImage:`url("${ne}")`,backgroundPosition:"center",backgroundRepeat:"no-repeat",backgroundSize:"cover",minHeight:"100vh","& .card":{maxWidth:350,borderRadius:12,margin:"1rem"}})),pe=S({shop:S({value:h().required("Url de comercio es requerido")}).required("Url de comercio es requerido"),email:h().email("Debe registrar un email válido").required("Licencia es requerido"),password:h().min(6,"Password debe contener al menos 6 caracteres").required("Password es requerido")}),mr=()=>{D();const t=se(),[a,i]=m.useState(!1),{login:l}=T(),[j,A]=m.useState(""),[b,u]=m.useState(!1),[y,L]=m.useState(!1),P=k(),o=N({defaultValues:{shop:null,email:"",password:"",remember:!0},resolver:J(pe)}),V=async r=>{if(b){i(!0);const{shop:s,email:n,password:q,remember:E}=r;try{await l(s==null?void 0:s.value,n,q),E?ae(s.value):te(s.value),t("/")}catch(F){A(F.message),i(!1)}}};return m.useEffect(()=>{if(!z(localStorage.getItem("shop"))){const r=k();o.setValue("shop",r.length>0?r[0]:null)}},[]),e.jsx(ce,{children:e.jsx(G,{className:"card",children:e.jsxs(c,{container:!0,children:[e.jsx(c,{item:!0,sm:12,xs:12,children:e.jsx(B,{p:4,height:"100%",children:e.jsx(me,{src:"/assets/images/logo-isiinvoice.png",alt:"Gestión de ventas y servicios",style:{paddingTop:"20px"}})})}),e.jsx(c,{item:!0,sm:12,xs:12,children:e.jsx(le,{children:e.jsxs("form",{onSubmit:o.handleSubmit(V),children:[e.jsx(c,{container:!0,spacing:5,children:e.jsxs(c,{item:!0,lg:12,md:12,sm:12,xs:12,sx:{mt:2},children:[e.jsx(d,{control:o.control,name:"shop",render:({field:r})=>{var s;return e.jsxs(v,{fullWidth:!0,error:!!o.formState.errors.shop,sx:{mb:2.5},children:[e.jsx(H,{shrink:!0,children:"URL Comercio"}),e.jsx(R,{...r,styles:W(!!o.formState.errors.shop),menuPosition:"fixed",name:"shop",placeholder:"Sel. o ingrese URL de comercio",value:r.value,onChange:n=>o.setValue("shop",n),options:P,isClearable:!0}),e.jsx(C,{children:((s=o.formState.errors.shop)==null?void 0:s.message)||""})]})}}),e.jsx(d,{control:o.control,render:({field:r})=>{var s;return e.jsx(_,{label:"Correo Electrónico",size:"small",sx:{mb:3,width:"100%"},id:"email",name:"email",value:r.value,onChange:r.onChange,error:!!o.formState.errors.email,helperText:(s=o.formState.errors.email)==null?void 0:s.message,InputLabelProps:{shrink:!0}})},name:"email"}),e.jsx(d,{render:({field:r})=>{var s;return e.jsxs(v,{size:"small",variant:"outlined",sx:{mb:2},onChange:r.onChange,fullWidth:!0,error:!!o.formState.errors.password,children:[e.jsx(X,{htmlFor:"password",shrink:!0,children:"Contraseña"}),e.jsx(K,{notched:!0,id:"password",label:"Contraseña",name:"password",type:y?"text":"password",value:r.value,endAdornment:e.jsx(Y,{position:"end",children:e.jsx(Z,{"aria-label":"toggle password visibility",onClick:()=>L(n=>!n),onMouseDown:n=>n.preventDefault(),edge:"end",children:y?e.jsx(Q,{}):e.jsx(ee,{})})})}),e.jsx(C,{children:(s=o.formState.errors.password)==null?void 0:s.message})]})},name:"password",control:o.control}),e.jsx(M,{style:{marginBottom:5},sitekey:"0x4AAAAAAAIR3qJWMFMaFVXX",theme:"light",onVerify:async r=>{u(!0),await ie(r)},onError:()=>u(!1),onLoad:()=>u(!1)}),e.jsx(x,{justifyContent:"space-between",children:e.jsx(x,{gap:1,children:e.jsx(d,{control:o.control,render:({field:r})=>e.jsxs(e.Fragment,{children:[e.jsx(re,{size:"small",name:"remember",onChange:r.onChange,checked:r.value,sx:{padding:0}}),e.jsx(w,{children:"Recordarme"})]}),name:"remember"})})}),e.jsx(oe,{type:"submit",color:"primary",loading:a,variant:"contained",disabled:!b,sx:{my:2},children:"Iniciar Sesión"})]})}),j&&e.jsx(w,{sx:{color:"red"},children:j})]})})})]})})})};export{mr as default};
