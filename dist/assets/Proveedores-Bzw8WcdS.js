import{r as t,j as e}from"./react-C-yax-zd.js";import{S as _}from"./SimpleContainer-tFVAehGQ.js";import{B as Q}from"./Breadcrumb-BAVYU1BR.js";import{A as z,M as U,g as m,s as M,a as b,b as W,j as H,p as J}from"./index-eXxrUaeE.js";import{e as Z}from"./@tanstack-CH50zjZF.js";import{M as X}from"./material-react-table-B3_JpHKP.js";import{A as Y}from"./AuditIconButton-Sfu7xKjf.js";import{S as ee,a as oe}from"./SimpleMenu-bKr1ysvp.js";import{S as re}from"./StackMenuActionTable-DYZWaJ7j.js";import{b as I,P}from"./index-CmjSjgDW.js";import{a as te,n as T}from"./notification-CZdNX9HX.js";import{g as B,G as k}from"./graphql-request-rGYrdPjm.js";import{b as ae,p as se,c as ie,d as ne,a as ce,P as le}from"./ProveedorRegistroDialog-Ce0LZXWf.js";import{o as de}from"./@hookform-CI7dTiWF.js";import{u as me}from"./react-hook-form-Cc6cmx_T.js";import{a5 as pe,a6 as ue,a7 as ge,a8 as he,g as x,P as fe,k as xe,bp as ve,B as D,ae as Se,bj as Ce,bo as je,b8 as Pe,$ as be,aJ as F,aN as we}from"./@mui-Cg5JgIJd.js";import{a as ye}from"./react-router-m6rhPc7O.js";import"./@babel-BWOPM2cf.js";import"./react-router-dom-BXf9Krd-.js";import"./react-dom-BMaWjgIA.js";import"./scheduler-CzFDRTuY.js";import"./@remix-run-DEp2-txB.js";import"./rc-input-number-DHeBSjOn.js";import"./@rc-component-BLzWySNC.js";import"./classnames-F3cnkUDL.js";import"./rc-input-CDxr26_S.js";import"./rc-util-RNQGGLoE.js";import"./react-is-DcfIKM1A.js";import"./react-toastify-Bq65RiZx.js";import"./clsx-B-dksMZM.js";import"./react-datepicker-D7PCQ8zk.js";import"./date-fns-9p2ure4y.js";import"./react-onclickoutside-vgQ6ifgl.js";import"./@floating-ui-BqRERJ-b.js";import"./perfect-scrollbar-BfaLzep3.js";import"./lodash-Dwhj6_6J.js";import"./jwt-decode-VWaDGczM.js";import"./sweetalert2-CxYvYGPM.js";import"./nanoid-CeQjyfxW.js";import"./@emotion-D9k8Qpvi.js";import"./hoist-non-react-statics-DQogQWOa.js";import"./stylis-NkKAe6Bn.js";import"./react-transition-group-C1IEqfrK.js";import"./dom-helpers-D0mFdbeO.js";import"./prop-types-tGFuYKac.js";import"./@popperjs-BQBsAJpH.js";import"./graphql-BS3ZITc9.js";import"./cross-fetch-Ml2K_YIJ.js";import"./highlight-words-DHKmS53s.js";import"./yup-DbVgGITq.js";import"./property-expr-DEi1ZLzV.js";import"./tiny-case-BJ7jYKNY.js";import"./toposort-CW3e93qZ.js";import"./yup-locales-C3yB5wWh.js";const Ae=B`
  mutation PROVEEDOR_ELIMINAR($codigoProveedor: [String]!) {
    proveedorEliminar(codigoProveedor: $codigoProveedor)
  }
`,Ee=async o=>{const s=new k("https://sandbox.isipass.net/api"),a=localStorage.getItem(z);return s.setHeader("authorization",`Bearer ${a}`),(await s.request(Ae,{codigoProveedor:o})).proveedorEliminar},Re=B`
  mutation PROVEEDOR_ACTUALIZACION($codigo: ID!, $input: ProveedorActualizarInput!) {
    proveedorActualizar(codigo: $codigo, input: $input) {
      ciudad
      contacto
      correo
      direccion
      nombre
      telefono
    }
  }
`,Ie=async(o,s)=>{try{const a=new k("https://sandbox.isipass.net/api"),c=localStorage.getItem(z);return a.setHeader("authorization",`Bearer ${c}`),(await a.request(Re,{codigo:o,input:s})).proveedorActualizar}catch(a){throw new U(a)}},De=(o,s)=>({codigo:o.codigo,nombre:m(o.nombre,""),direccion:m(o.direccion,""),ciudad:m(o.ciudad,""),contacto:m(o.contacto,""),correo:m(o.correo,""),telefono:m(o.telefono,""),action:s}),Fe=o=>{const{onClose:s,open:a,proveedor:c,...p}=o,d=me({defaultValues:{...ae,action:I.UPDATE},resolver:de(se)}),h=async g=>{const n=await ne(),{codigo:v,action:w,...S}=g;n.length>0?te(n.join("<br>")):await M({preConfirm:async()=>{const i=await Ie(v||"",S).catch(y=>({error:y}));return i&&i.error?(b(i.error),!1):i}}).then(i=>{i.isConfirmed&&(T(),s(i.value)),i.isDenied&&b(i.value)})},u=(g,n)=>{console.error("Error:",g,n)};return t.useEffect(()=>{c&&a&&d.reset(De(c,I.UPDATE))},[a]),e.jsxs(pe,{sx:{"& .MuiDialog-paper":{width:"100%",maxHeight:500}},maxWidth:"sm",open:a,...p,children:[e.jsxs(ue,{children:["Editar Proveedor ",d.control._formValues.codigo]}),e.jsx(ge,{dividers:!0,children:e.jsx(ie,{form:d})}),e.jsxs(he,{children:[e.jsx(x,{autoFocus:!0,color:"error",size:"small",variant:"contained",onClick:()=>{s()},children:"Cancelar"}),e.jsx(x,{onClick:d.handleSubmit(h,u),size:"small",style:{marginRight:25},variant:"contained",children:"Actualizar Proveedor"})]})]})},ze=[{accessorKey:"codigo",header:"Código"},{accessorKey:"nombre",header:"Proveedor"},{accessorKey:"direccion",header:"Dirección"},{accessorKey:"ciudad",header:"Ciudad"},{accessorKey:"contacto",header:"Contacto"},{accessorKey:"correo",header:"Correo Electrónico"},{accessorKey:"telefono",header:"Teléfono"},{accessorFn:o=>e.jsx(be,{size:"small",label:o.state,color:"success"}),id:"state",header:"Estado"}],Me=o=>{ye();const[s,a]=t.useState(null),[c,p]=t.useState(!1),[d,h]=t.useState(!1),[u,g]=t.useState([]),[n,v]=t.useState({pageIndex:P.page,pageSize:P.limit}),[w,S]=t.useState(0),[i,y]=t.useState(!1),[C,O]=t.useState([]);t.useState("");const[q,A]=t.useState({}),[Te,E]=t.useState(!1),N=async()=>{E(!0);try{await f()}catch(r){console.error("Error al recargar los datos:",r)}E(!1)},{data:L,isError:R,isLoading:$,status:Be,refetch:f}=Z({queryKey:["proveedoresListado",u,n.pageIndex,n.pageSize,C],queryFn:async()=>{const r=W(u),j={...P,page:n.pageIndex+1,limit:n.pageSize,reverse:C.length<=0,query:r},{pageInfo:l,docs:G}=await ce(j);return S(l.totalDocs),G},refetchOnWindowFocus:!1,refetchInterval:!1}),K=t.useMemo(()=>ze,[]),V=async r=>{const j=r.map(l=>l.original.codigo);await M({text:"Confirma que desea eliminar los registros seleccionados, esta operación no se podra revertir",preConfirm:()=>Ee(j).catch(l=>(b(l),!1))}).then(l=>{l.isConfirmed&&(T(),A({}),f())})};return e.jsxs(e.Fragment,{children:[e.jsx(fe,{elevation:0,variant:"elevation",square:!0,sx:{mb:2,p:.5,bgcolor:"#FAFAFA"},className:"asideSidebarFixed",children:e.jsx(xe,{direction:{xs:"column",sm:"row"},style:{marginTop:2},spacing:{xs:1,sm:1,md:1,xl:1},justifyContent:"flex-end",children:e.jsxs(x,{size:"small",variant:"contained",onClick:()=>p(!0),startIcon:e.jsx(ve,{}),color:"success",children:[" ","Nuevo Proveedor"]})})}),e.jsx(D,{sx:{mb:2,m:"1rem"},children:e.jsx(X,{columns:K,data:L??[],initialState:{showColumnFilters:!1},manualFiltering:!0,manualPagination:!0,manualSorting:!0,muiToolbarAlertBannerProps:R?{color:"error",children:"Error loading data"}:void 0,onColumnFiltersChange:g,onPaginationChange:v,onSortingChange:O,enableDensityToggle:!1,enableGlobalFilter:!1,rowCount:w,state:{columnFilters:u,isLoading:$,pagination:n,showAlertBanner:R,showProgressBars:i,density:"compact",sorting:C,rowSelection:q},muiSearchTextFieldProps:{variant:"outlined",placeholder:"Busqueda",InputLabelProps:{shrink:!0},size:"small"},enableRowActions:!0,positionActionsColumn:"first",renderRowActions:({row:r})=>e.jsxs("div",{style:{display:"flex",flexWrap:"nowrap",gap:"0.5rem",width:100},children:[e.jsx(ee,{menuButton:e.jsx(e.Fragment,{children:e.jsx(Se,{"aria-label":"delete",children:e.jsx(Ce,{})})}),children:e.jsxs(oe,{onClick:()=>{a(r.original.codigo),h(!0)},children:[e.jsx(je,{})," Modificar"]})}),e.jsx(Y,{row:r.original})]}),enableRowSelection:!0,onRowSelectionChange:A,displayColumnDefOptions:{"mrt-row-actions":{muiTableHeadCellProps:{align:"center"},size:120}},renderTopToolbarCustomActions:({table:r})=>e.jsxs(D,{sx:{display:"flex",gap:"1rem",p:"0.5rem",flexWrap:"wrap"},children:[e.jsx(re,{refetch:N,sx:{flexGrow:1}}),e.jsx(x,{color:"error",onClick:()=>V(r.getSelectedRowModel().flatRows),startIcon:e.jsx(Pe,{}),variant:"contained",size:"small",disabled:r.getSelectedRowModel().flatRows.length===0,sx:{height:"28px",top:"0.5rem"},children:"Eliminar"})]})})}),e.jsx(le,{id:"proveedorRegistroDialog",keepMounted:!1,open:c,onClose:r=>{r&&f().then(),p(!1)}}),e.jsx(Fe,{keepMounted:!1,open:d,proveedor:s||null,onClose:r=>{r&&f().then(),a(null),h(!1)}})]})},Oo=()=>(t.useContext(H),e.jsx(e.Fragment,{children:e.jsxs(_,{children:[e.jsx("div",{className:"breadcrumb",children:e.jsx(Q,{routeSegments:[{name:"Servicios",path:J.gestion},{name:"Proveedores"}]})}),e.jsx(F,{container:!0,spacing:2,children:e.jsx(F,{item:!0,lg:12,md:12,xs:12,children:e.jsx(Me,{})})}),e.jsx(we,{py:"12px"})]})}));export{Oo as default};
